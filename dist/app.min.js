angular.module("dictionaryViewMdl",[]),angular.module("spacedRevisionMdl",[]),angular.module("TextMdl",[]),angular.module("VideoMdl",[]),angular.module("app",["ngRoute","TextMdl","VideoMdl","ngMaterial","ngResource","ngMessages","ngSanitize","material.svgAssetsCache","ui-deni-grid","uiDeniModalMdl","spacedRevisionMdl","com.2fdevs.videogular","com.2fdevs.videogular.plugins.controls","info.vietnamcode.nampnq.videogular.plugins.youtube","summernote"]),angular.module("app").config(function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|javascript):/)}),angular.module("app").service("categoryRestSrv",function(e){var t=this;t.add=function(t,n){var i={title:"Adding",message:"Category added successfully!"};return e.requestWithPromise("category/add",{cd_categoria_pai:t,ds_categoria:n},i)},t.rename=function(t,n){var i={title:"Editing",message:"Category renamed successfully!"};return e.requestWithPromise("category/upd",{cd_categoria:t,ds_categoria:n},i)},t.del=function(t){var n={title:"Deleting",message:"Category deleted successfully!"};return e.requestWithPromise("category/del",{cd_categoria:t},n,"Confirm deleting?")}}),angular.module("app").service("categorySrv",function(e,t,n){var i=this;i.add=function(i,r){var o=e.defer();return n.prompt("New Category","Enter a descrption of the category","",!0,i).then(function(e){t.add(r,e).then(function(e){o.resolve(e.data.data[0])})}),o.promise},i.rename=function(i,r,o){var a=e.defer();return n.prompt("Renaming Category","Enter a descrption of the category",o,!0,i).then(function(e){t.rename(r,e).then(function(e){a.resolve(e.data.data[0].dsCategoria)})}),a.promise},i.del=function(e){return t.del(e)}}),angular.module("app").service("DictionaryRestSrv",function(e){var t=this;t.list=function(){return e.requestWithPromise("dictionary/list")},t.add=function(t,n){var i={title:"Inserting",message:"Expression added successfully!"};return e.requestWithPromise("dictionary/add",{ds_expressao:t,ds_tags:n},i)},t.del=function(t){var n={title:"Deleting",message:"Expression deleted successfully!"};return e.requestWithPromise("dictionary/del",{cd_dicionario:t},n,"Confirm deleting?")},t.learnedToogle=function(t){var n={title:"Updating",message:"Expression updated successfully!"};return e.requestWithPromise("dictionary/learned/toogle",{cd_dicionario:t},n)},t.definitionSet=function(t,n){var i={title:"Updating",message:"Expression updated successfully!"};return e.requestWithPromisePayLoad("dictionary/definition/set",{},{cd_dicionario:t,tx_definicao:n},i)},t.definitionGet=function(t){return e.requestWithPromise("dictionary/definition/get",{cd_dicionario:t})}}),angular.module("app").service("dictionarySrv",function(e,t){var n=this;n.list=function(){return t.list()},n.add=function(e,n){return t.add(e,n)},n.del=function(e){return t.del(e)},n.learnedToogle=function(e){return t.learnedToogle(e)},n.definitionSet=function(e,n){return t.definitionSet(e,n)},n.definitionGet=function(n){var i=e.defer();return t.definitionGet(n).then(function(e){i.resolve(e.data.data[0].txDefinicao)}),i.promise}}),angular.module("app").service("ItemRestSrv",function(e){var t=this;t.list=function(t){return e.requestWithPromise("item/list",{cd_categoria:t})},t.get=function(t){return e.requestWithPromise("item/get",{cd_item:t})},t.add=function(t,n,i,r){var o={title:"Inserting",message:"Item added successfully!"};return e.requestWithPromisePayLoad("item/add",{topCategoryNode:t,cd_categoria:n,ds_item:i},{bt_imagem:r},o)},t.upd=function(t,n,i,r){var o={title:"Updating",message:"Item updated successfully!"};return e.requestWithPromisePayLoad("item/upd",{cd_item:t,cd_categoria:n,ds_item:i},{bt_imagem:r},o)},t.del=function(t){var n={title:"Deleting",message:"Item deleted successfully!"};return e.requestWithPromise("item/del",{cd_item:t},n,"Confirm deleting?")},t.favorite={set:function(t,n){return e.requestWithPromise("item/favorite/set",{cd_item:t,bl_favorite:n})},get:function(t){return e.requestWithPromise("item/favorite/get",{cd_item:t})}}}),angular.module("app").service("itemSrv",function(e,t,n,i,r,o,a,s,d){var c=this,l=function(e){var o=t.defer(),s=r.createWindowDescriptionMoreImage();return s.show().then(function(e){if("ok"==e.button){var t=i.getDataURLImagemObjeto(e.data.imageEl.get(0),150,150,.5);n.add(a.CategoryType.TEXT,i.currentCategory,e.data.description,t).then(function(e){o.resolve(e)})}else o.reject()}),o.promise},u=function(n){var r=t.defer();return n.newVideoItemModal={canShowImagePreview:!1,tp_video:0},n.newVideoItemModal.getImagePreviewUrl=function(){return n.newVideoItemModal.canShowImagePreview=n.newVideoItemModal.id_video&&(0==n.newVideoItemModal.tp_video&&11==n.newVideoItemModal.id_video.length||1==n.newVideoItemModal.tp_video&&28==n.newVideoItemModal.id_video.length),n.newVideoItemModal.canShowImagePreview?d.SERVER_URL+"item/image/getlink?tp_video="+n.newVideoItemModal.tp_video+"&id_video="+n.newVideoItemModal.id_video:null},o.showModal(n).then(function(t){e.loading=!0,s.add(i.currentCategory,n.newVideoItemModal.tp_video,n.newVideoItemModal.id_video,n.newVideoItemModal.description).then(function(t){r.resolve(t),e.loading=!1})}),r.promise};c.add=function(e,t){return t==a.CategoryType.TEXT?l(e):u(e)},c.del=function(e){return n.del(e)},c.favorite={set:function(e,i){var r=t.defer();return n.favorite.set(e,i).then(function(e){r.resolve(e.data.data[0].blFavorite)},function(e){r.reject(e)}),r.promise},get:function(e){var i=t.defer();return n.favorite.get(e).then(function(e){i.resolve(e.data.data[0].blFavorite)},function(e){i.reject(e)}),i.promise}}}),angular.module("app").service("PronunciationRestSrv",function(e){var t=this;t.list=function(){return e.requestWithPromise("pronunciation/list")},t.add=function(t){var n={title:"Inserting",message:"Expression added successfully!"};return e.requestWithPromise("pronunciation/add",{ds_expressao:t},n)},t.del=function(t){var n={title:"Deleting",message:"Expression deleted successfully!"};return e.requestWithPromise("pronunciation/del",{cd_pronuncia:t},n,"Confirm deleting?")},t.learnedToogle=function(t){var n={title:"Updating",message:"Expression updated successfully!"};return e.requestWithPromise("pronunciation/learned/toogle",{cd_pronuncia:t},n)}}),angular.module("app").service("pronunciationSrv",function(e,t){this.listenExpression=function(n){var i=e.defer();try{if(event.ctrlKey&&event.shiftKey){var r="http://www.wordreference.com/enpt/";t.open(r+n)}else var o=setInterval(function(){var e=speechSynthesis.getVoices();if(0!==e.length){clearInterval(o);var t=new SpeechSynthesisUtterance;t.text=n,t.lang="en-US";for(var r=0;r<e.length;r++)if(e[r].lang==t.lang){t.voice=e[r];break}t.rate=.8,t.onstart=function(e){},t.onend=function(e){i.resolve()},speechSynthesis.speak(t)}},200)}catch(a){i.reject(a)}return i.promise}}),angular.module("app").service("RevisionRestSrv",function(e){var t=this;t.getItemInfo=function(t){return e.requestWithPromise("revision/item/info",{cd_item:t})},t.getExpressions=function(t){return e.requestWithPromise("revision/expressions/get",{cd_item:t})},t.setLevelOfLearning=function(t,n,i){return e.requestWithPromise("revision/expressions/levelOfLearning/set",{cd_dicionario:t,cd_pronuncia:n,nr_level_of_learning:i})},t.markAsReviewed=function(t){return e.requestWithPromise("revision/markasreviewed",{cd_item:t})}}),angular.module("app").service("revisionSrv",function(e,t){var n=this;n.getItemInfo=function(n){var i=e.defer();return t.getItemInfo(n).then(function(e){var t=e.data.data[0];i.resolve(t)},function(e){i.reject(e)}),i.promise},n.getExpressions=function(n){var i=e.defer();return t.getExpressions(n).then(function(e){var t=e.data.data;i.resolve(t)},function(e){i.reject(e)}),i.promise},n.setLevelOfLearning=function(n,i,r){var o=e.defer();return t.setLevelOfLearning(n,i,r).then(function(e){var t=e.data.data[0];o.resolve(t)},function(e){o.reject(e)}),o.promise}}),angular.module("app").service("DatabaseSrv",function(){}),angular.module("app").service("GeneralSrv",function(e,t,n,i,r,o){var a=this;a.getAllExpressions=function(){var t=e.defer();return i.list().then(function(e){o.dictionaryExpressions=e.data.data,r.list().then(function(e){o.pronunciationExpressions=e.data.data,o.allExpressions=o.dictionaryExpressions.concat(o.pronunciationExpressions),t.resolve(o.allExpressions)},function(e){console.error(e)})},function(e){console.error(e)}),t.promise},a.insertHtmlWithController=function(e,t,i,r){e.html("");var o=$("<div>"+t+"</div>");n(o)(r),e.append(o)}}),angular.module("app").service("StringSrv",function(e){var t=this;t.format=function(){for(var e=arguments[0],t=1;t<arguments.length;t++){var n=new RegExp("\\{"+(t-1).toString()+"\\}","gi");e=e.replace(n,arguments[t])}return e},t.leftPad=function(e,t,n){var i=t-e.toString().length+1;return Array(+(i>0&&i)).join(n)+e},t.replaceAll=function(e,t,n){return e?e.replace(RegExp("\\b"+t+"\\b","g"),n):""},t.doubleToStrTime=function(e){var n=3600,i=60,r=e/n,o=t.leftPad(Math.floor(r),2,"0"),a=e/i,s=t.leftPad(Math.floor(a),2,"0"),d=(e%i).toString(),c="000",l=d.indexOf(".");return l!=-1&&(c=d.substring(l+1).substring(0,3),c+="0".repeat(3-c.length),d=d.substring(0,l)),d=t.leftPad(Math.floor(d),2,"0")+","+c,o+":"+s+":"+d},t.strTimeToDouble=function(e){var t=e,n=parseInt(t.substring(0,2)),i=parseInt(t.substring(3,5));t=t.substring(6,t.length).replace(",",".");var r=parseFloat(t);return 3600*n+60*i+r},t.addLinksDictionaryAndPronunciation=function(n){var i=e.allExpressions;if(0==i.length)return n;for(var r=t.replaceAll(n,'"',"'"),o=r.toLowerCase(),a="matrizsubst1-{0}-matrizsubst2",s=[],d=0,c=0;c<i.length;c++)for(var l=i[c],u=l.dsExpressao.toLowerCase(),m=o.search(new RegExp("\\b"+u+"\\b"));m!=-1;){var p=r.substring(m,m+u.length);if(p.toLowerCase()==u){s.push({cd_pronuncia:l.cdPronuncia,cd_dicionario:l.cdDicionario,ds_expressao:l.dsExpressao,texto:p});var g=t.format(a,d);r=r.replace(new RegExp("\\b"+p+"\\b","g"),g),d++,o=r.toLowerCase()}m=o.search(new RegExp("\\b"+u+"\\b"))}for(var c=0;c<s.length;c++){var l=s[c],f=t.format(a,c),v=null,h=null,x=null;l.cd_dicionario?(h="openDictionary",x="dictionary-link"):(h="openPronunciation",x="pronunciation-link"),v=t.format('<span class="'+x+'" ng-click="'+h+"('"+l.ds_expressao+"');\">"+l.ds_expressao+"</span>",t.replaceAll(l.ds_expressao,"'","\\'"),t.replaceAll(l.texto,"'","\\'")),r=t.replaceAll(r,f,v)}return r}}),angular.module("app").service("newVideoItemModalSrv",function(e,t){var n=this;n.showModal=function(n){var i=e.defer(),r=t.createWindow({scope:n,title:"Creating a new video",width:"550px",height:"300px",position:t.POSITION.CENTER,buttons:[t.BUTTON.OK,t.BUTTON.CANCEL],urlTemplate:"src/app/shared/item/new-video-item-modal/new-video-item-modal.tpl.htm",modal:!0,listeners:{onshow:function(e){n.newVideoItemModal.kindOfVideo=0}}});return r.show().then(function(e){"ok"==e.button?i.resolve(n.newVideoItemModal):i.reject()}),i.promise}}),angular.module("dictionaryViewMdl").controller("dictionaryViewSrv",function(){}),angular.module("spacedRevisionMdl").service("spacedRevisionSrv",function(e,t,n,i,r){var o=this;o.selectExpression=function(e,t){e.expressions.length>0&&(e.currentExpressionIndex=t,e.currentExpression=e.expressions[t],e.model.expression.dsExpressao=e.currentExpression.dsExpressao,e.model.expression.type=0!=e.currentExpression.cdDicionario?"Dictionary":"Pronuciation",e.model.expression.resultType=0!=e.currentExpression.cdDicionario?"menu":"volume_up",e.model.expression.learnedRate=e.currentExpression.nrLevelOfLearning,e.model.expression.definition="")},o.showResult=function(e){0!=e.currentExpression.cdDicionario?(event.ctrlKey&&n.listenExpression(e.model.expression.dsExpressao),t.definitionGet(e.currentExpression.cdDicionario).then(function(t){e.model.expression.definition=t;var n=$(document.createElement("div"));n.html(t),$(".definition-detail-content-content").html(""),$(".definition-detail-content-content").append(n)})):angular.isDefined(e.currentExpression.cdPronuncia)&&n.listenExpression(e.model.expression.dsExpressao)},o.updateLearnedPercentage=function(e){for(var t=e.element.find(".item-detail-data-progress-bar"),n=t.width(),i=0,r=0;r<e.expressions.length;r++)i+=e.expressions[r].nrLevelOfLearning;var o=i/e.expressions.length;e.model.learnedPercentage=o.toFixed(2);var a=e.element.find(".item-detail-data-progress");a.width(n*o/100)},o.markAsReviewed=function(e){return i.markAsReviewed(e).then(function(){r.ghost("Spaced Revision","Item marked as reviewed successfuly!")})},o.showModal=function(t){e.selectedCdItem=t,r.createWindow({scope:e,title:"Spaced Revision",width:"900px",height:"600px",position:r.POSITION.CENTER,buttons:[r.BUTTON.OK],urlTemplate:"src/app/shared/spaced-revision/directives/spaced-revision/spaced-revision-modal.htm",modal:!0}).show()}}),angular.module("app").controller("NewVideoItemModalCtrl",function(e){var t=this,n=function(e,t,n,i){var r=0,o=0;e instanceof HTMLImageElement?(r=e.naturalWidth,o=e.naturalHeight):(r=e.videoWidth,o=e.videoHeight);var a=document.createElement("canvas"),s=t,d=n,c=1;o>r?(c=s/r,d=c*o):(c=d/o,s=c*r),a.width=s,a.height=d;var l=a.getContext("2d");return l.drawImage(e,0,0,r,o,0,0,s,d),a.toDataURL("image/jpeg",i)};t.capturePosterFromVideo=function(){var e=$(".video-preview").get(0),t=n(e,150,150,.5);console.log(t)}}),angular.module("dictionaryViewMdl").controller("DictionaryViewCtrl",function(){}),angular.module("spacedRevisionMdl").controller("SpacedRevisionCtrl",function(e,t,n,i,r,o,a){var s=this;s.learnedRate=60,s.expressions=[],s.currentExpression,s.currentExpressionIndex,s.model={expression:{}},s.model.navigatorStatus="",s.navigate=function(e){a.selectExpression(s,s.currentExpressionIndex+e)},s.navigateFirst=function(){a.selectExpression(s,0)},s.navigateLast=function(){a.selectExpression(s,s.expressions.length-1)},s.showResult=function(){a.showResult(s)},s.changeLearnedRate=function(){r.setLevelOfLearning(s.currentExpression.cdDicionario,s.currentExpression.cdPronuncia,s.model.expression.learnedRate),s.currentExpression.nrLevelOfLearning=s.model.expression.learnedRate,a.updateLearnedPercentage(s)},s.markAsReviewed=function(e){a.markAsReviewed(e),console.log("TODO: FAZER UMA ROTINA NA uiDeniModal para fechar a janela ativa..."),console.log("TODO: VERIFICAR TAMBÉM O UI-DENI-MODAL... PASSAGEM DO Scope...")},s.cdItem?(s.itemImage=e.format("{0}item/image/get?cd_item={1}&time={2}",t.SERVER_URL,s.cdItem,(new Date).getMilliseconds()),r.getItemInfo(s.cdItem).then(function(e){s.dsItem=e.dsItem,s.dsBreadCrumbPath=e.dsBreadCrumbPath})):new Error("Attributes passed in a wrong way!")}),angular.module("dictionaryViewMdl").directive("dictionaryView",function(){return{restrict:"E",bindToController:{expressao:"="},controller:"DictionaryViewCtrl",controllerAs:"ctrl",templateUrl:"srv/app/shared/dictionary-view/dictionary-view.tpl.htm"}}),angular.module("spacedRevisionMdl").directive("spacedRevision",function(e,t){return{restrict:"E",bindToController:{cdItem:"@",showItemDetail:"@"},controller:"SpacedRevisionCtrl",controllerAs:"ctrl",templateUrl:"src/app/shared/spaced-revision/directives/spaced-revision/spaced-revision.tpl.htm",link:function(n,i,r,o,a){n.$watch("ctrl.cdItem",function(r,o){r&&t.getExpressions(r).then(function(t){n.ctrl.expressions=t,e.selectExpression(n.ctrl,0),n.ctrl.element=i,e.updateLearnedPercentage(n.ctrl)})})}}}),angular.module("app").service("homeSrv",function(e,t,n,i,r,o,a,s,d,c){var l=this,u=null;l.addCategoryClick=function(e,n){t.add(e,n).then(function(e){var t={state:"open",id:e.cdCategoria,text:e.dsCategoria,data:e};u.create_node(n,t,"last",function(e){u.deselect_all(),u.select_node(e)})})},l.editCategoryClick=function(e,n){t.rename(e,n.id,n.text).then(function(e){u.rename_node(n,e)})},l.delCategoryClick=function(e){t.del(e.id).then(function(t){var n=u.get_node(e.parent);u.delete_node([e]),u.select_node(n)})};var m=function(e){return"#"==e.currentCategoryNode.parent?e.currentCategoryNode.id:e.currentCategoryNode.parents[e.currentCategoryNode.parents.length-2]};l.addNewItemButtonClick=function(e,t,n){var i=m(e);r.add(t,i).then(function(t){e.gridOptions.api.reload().then(function(n){var i=t.data[0],r=i.cdItem||i.t05itm.cdItem;e.gridOptions.api.findKey(r,{inLine:!0})})})};var p=function(e,t){e.currentCategoryNode=t.node,i.currentCategory=e.currentCategoryNode.id;for(var n='<span class="categoryPathTitle">'+e.currentCategoryNode.text+"</span>",r=e.currentCategoryNode.parent;"#"!=r;){var o=t.instance.get_node(r);n=o.text+" / "+n;var r=o.parent}e.categoryPath=n};l.reloadDataGrid=function(e){e.currentCategoryNode&&("pageItems"==e.currentNavItem?e.gridOptions.url=n.SERVER_URL+"item/list?cd_categoria="+e.currentCategoryNode.id:"pageRevisions"==e.currentNavItem?e.gridOptions.url=n.SERVER_URL+"revision/list?pendente=true&days=5&cd_categoria="+e.currentCategoryNode.id:e.gridOptions.url=n.SERVER_URL+"item/favorite/get?cd_categoria="+e.currentCategoryNode.id,e.gridOptions.api.reload())},l.configureTreeView=function(e,t){$("#categoryTreeview").on("loaded.jstree",function(e,n){u=n.instance,t&&u.select_node(t)}).on("changed.jstree",function(t,n){n.node&&(p(e,n),l.reloadDataGrid(e))}).jstree({core:{check_callback:!0,data:{url:n.SERVER_URL+"category/category/tree/list",dataType:"json"}},plugins:["wholerow"]})},l.configureGridItems=function(t){t.gridOptions={hideHeaders:!0,colLines:!1,keyField:"cdItem",rowHeight:"100px",columns:[{header:"Item",name:"cdItem",width:"calc(100% - 96px)",renderer:function(e,i){var r=null,s=m(t);r=s==o.CategoryType.TEXT?"/text":"/video";var d=new Date,c=d.getMilliseconds(),l=i.blFavorite?"star":"star_border",u=i.blFavorite?"selected":"",p='<div class="cell-template">\n    <img class="item-image"\n        src="{0}item/image/get?cd_item={1}&time={5}" \n    />\n    <div><a href="#{2}/{1}">{3}</a></div>\n    <div>{4}</div>\n    <md-icon class="material-icons favorite {6}" ng-click="funcaoTeste()"> {7} </md-icon>\n<div>';return a.format(p,n.SERVER_URL,i.cdItem,r,i.dsItem,"blá blá blá blá",c,u,l)}},{width:"32px",action:{mdIcon:"restore",tooltip:"",fn:function(e,t,n){s.showModal(e.cdItem)}}},{width:"32px",action:{mdIcon:"edit",tooltip:"",fn:function(e,n,r){var o=$(r).closest(".ui-row"),a=o.find(".item-image"),s={description:e.dsItem,imgSrc:a.attr("src")},l=d.createWindowDescriptionMoreImage(s);l.show().then(function(n){"ok"==n.button&&c.upd(e.cdItem,i.currentCategory,n.data.description,n.data.image).then(function(e){t.gridOptions.api.reload().then(function(i){a.attr("src",n.data.image);var r=e.data[0].cdItem;t.gridOptions.api.findKey(r,{inLine:!0})})})})}}},{width:"32px",action:{mdIcon:"delete_forever",tooltip:"",fn:function(e,n,i){r.del(e.cdItem).then(function(){t.gridOptions.api.reload()})}}}],listeners:{onafterload:function(e,t){},onafterrepaintrow:function(n,i){e(function(){i.find(".material-icons.favorite").click(function(e){var n=t.gridOptions.api.getSelectedRow();r.favorite.set(n.cdItem,!n.blFavorite).then(function(e){n.blFavorite=e,t.gridOptions.api.repaintSelectedRow()})})},500)}}}}}),angular.module("app").service("TextRestSrv",function(e){var t=this;t.list=function(t){return e.requestWithPromise("text/list",{cd_item:t})},t.getContent=function(t){return e.requestWithPromise("text/content/get",{cd_texto:t})},t.setContent=function(t,n){var i={title:"Texts",message:"text updated successfully!"};return e.requestWithPromisePayLoad("text/content/set",{},{cd_texto:t,tx_conteudo:n},i)}}),angular.module("TextMdl").service("TextSrv",function(e,t,n,i){var r=this;r.configWYSIWYG=function(n,i){var o=function(){t.setContent(n.t07txt.cdTexto,n.content).then(function(e){r.setContent(n,i,e.data[0].txConteudo),n.editing=!1})},a=function(){n.content=n.contentStored,n.editing=!1,i.$apply()};n.options=e.getConfigWYSIWYG(o,a)},r.setContent=function(e,t,r){var o=$(".text .text-content");e.content=r,e.formatedContent=n.addLinksDictionaryAndPronunciation(e.content),i.insertHtmlWithController(o,e.formatedContent,"TextCtrl",t)}}),angular.module("app").service("VideoRestSrv",function(e){var t=this;t.add=function(t,n,i,r){var o={title:"Videos",message:"Video added successfully!"};return e.requestWithPromisePayLoad("video/add",{},{cd_categoria:t,tp_video:n,id_video:i,ds_item:r},o)},t.get=function(t){return e.requestWithPromise("video/get",{cd_item:t})},t.commentaries={set:function(t,n){var i={title:"Videos",message:"commentary updated successfully!"};return e.requestWithPromisePayLoad("video/commentary/set",{cd_video:t},{txCommentaries:n},i)}}}),angular.module("VideoMdl").service("VideoSrv",function(e,t,n,i,r,o,a,s,d){var c=this,l=function(e,t){for(var n=e.gridSubtitlesOptions.data,i=0;i<n.length;i++){var r=n[i];if(t>=r.nrStart&&t<=r.nrEnd){i!=e.gridSubtitlesOptions.api.getSelectedRowIndex()&&e.gridSubtitlesOptions.api.selectRow(i,!0,!1);break}}},u=!1;c.configElementVideo=function(e,n){var a=r.defer();return e.onPlayerReady=function(t){e.videoAPI=t,e.videoAPI.autoPlay=!1;var n=i(function(){angular.isDefined(e.currentTime)&&i.cancel(n)},1e3)},e.onUpdateTime=function(t,n){e.currentTime=1e3*t,e.totalTime=1e3*n,e.timeLeft=e.totalTime-e.currentTime,u||l(e,t)},o.get(n).then(function(n){var i=n.data.data[0];a.resolve(i);"YOUTUBE"==i.tpVideo?urlImage="https://www.youtube.com/watch?v="+i.idVideo:urlImage="https://googledrive.com/host/"+i.idVideo,e.videoConfig={autoPlay:!1,sources:[{src:t.trustAsResourceUrl(urlImage),type:"video/mp4"}],theme:{url:"dist/videogular/videogular.css"},plugins:{controls:{autoHide:!0,autoHideTime:5e3}}}}),a.promise},c.configGridSubtitles=function(t,i){t.gridSubtitlesOptions={keyField:"cdItemSubtitle",rowHeight:"37px",url:a.SERVER_URL+"/subtitle/list?cd_item="+i,hideHeaders:!0,columns:[{name:"nrStart",width:"15%",align:"center",renderer:function(e,t){return s.doubleToStrTime(e)}},{name:"nrEnd",width:"15%",align:"center",renderer:function(e,t){return s.doubleToStrTime(e)}},{name:"dsTexto",width:"80%",renderer:function(e,i){var r=$("<div>"+s.addLinksDictionaryAndPronunciation(e)+"</div>");return n(r)(t.scope),r}}],listeners:{onselectionchange:function(n,i,r,o){u=!0;try{t.videoAPI.seekTime(o.nrStart)}finally{e(function(){u=!1},1500)}}}}},c.configWYSIWYG=function(e,t){var n=function(){o.commentaries.set(e.t08vdo.cdVideo,e.t08vdo.txComentarios)},i=function(){o.get(t).then(function(t){e.t08vdo=t.data.data[0]})};e.options=d.getConfigWYSIWYG(n,i)}}),angular.module("app").service("SubtitleRestSrv",function(e){var t=this;t.list=function(t){return e.requestWithPromise("subtitle/list",{cd_item:t})},t.add=function(t,n,i,r){var o={title:"Inserting",message:"Subtitle added successfully!"};return e.requestWithPromisePayLoad("subtitle/add",{},{cd_video:t,nr_start:n,nr_end:i,ds_texto:r},o)},t.upd=function(t,n,i,r){var o={title:"Updating",message:"Subtitle updated successfully!"};return e.requestWithPromisePayLoad("subtitle/upd",{},{cd_item_subtitle:t,nr_start:n,nr_end:i,ds_texto:r},o)},t.del=function(t){var n={title:"Deleting",message:"Subtitle deleted successfully!"};return e.requestWithPromise("subtitle/del",{cd_item_subtitle:t},n,"Confirm deleting?")}}),angular.module("VideoMdl").service("subtitleModalSrv",function(e,t,n,i){var r=this,o={ADDING:1,EDITING:2},a=function(r,a,s){var d=e.defer();a.subtitleModalData={};var c=a.gridSubtitlesOptions.api.getSelectedRow();if(s==o.EDITING){var c=a.gridSubtitlesOptions.api.getSelectedRow();a.subtitleModalData.start=n.doubleToStrTime(c.nrStart),a.subtitleModalData.end=n.doubleToStrTime(c.nrEnd),a.subtitleModalData.text=c.dsTexto}else c&&(a.subtitleModalData.start=n.doubleToStrTime(c.nrStart+1),a.subtitleModalData.end=n.doubleToStrTime(c.nrStart+2));var l=t.createWindow({scope:r,title:"Subtitles",width:"450px",height:"230px",position:t.POSITION.CENTER,buttons:[t.BUTTON.OK,t.BUTTON.CANCEL],urlTemplate:"src/app/components/video/subtitle/modals/subtitle-modal.tpl.htm",modal:!0,listeners:{onshow:function(e){}}});return l.show().then(function(e){if("ok"==e.button){a.subtitleModalData.start=n.strTimeToDouble(a.subtitleModalData.start),a.subtitleModalData.end=n.strTimeToDouble(a.subtitleModalData.end),console.log(a.subtitleModalData),s==o.EDITING?i.upd(c.cdItemSubtitle,a.subtitleModalData.start,a.subtitleModalData.end,a.subtitleModalData.text).then(function(e){d.resolve(e.data[0])}):i.add(a.t08vdo.cdVideo,a.subtitleModalData.start,a.subtitleModalData.end,a.subtitleModalData.text).then(function(e){d.resolve(e.data[0])})}else d.reject("")}),d.promise};r.add=function(e,t){return a(e,t,o.ADDING)},r.edit=function(e,t){return a(e,t,o.EDITING)}}),angular.module("app").controller("HomeCtrl",function(e,t,n,i,r){var o=this;r.createHamburgerButton(["show-xs","hide-gt-xs"],i.Side.LEFT),o.categoryPath=null,o.currentNavItem="pageItems",o.currentCategoryNode=null,$.jstree.defaults.core.themes.variant="large",o.addCategoryClick=function(){n.addCategoryClick(e,o.currentCategoryNode.id)},o.editCategoryClick=function(){n.editCategoryClick(e,o.currentCategoryNode)},o.delCategoryClick=function(){n.delCategoryClick(o.currentCategoryNode)},o.addNewItemButtonClick=function(t){n.addNewItemButtonClick(o,e,t)},n.configureTreeView(o,r.currentCategory||t.cdCategoria),n.configureGridItems(o),e.$watch("ctrl.currentNavItem",function(e,t){o.currentNavItem=e,e&&n.reloadDataGrid(o)})}),angular.module("TextMdl").controller("TextCtrl",function(e,t,n,i,r,o,a,s,d){var c=this;c.editing=!1,c.params=n,c.texts=[],c.selectedIndex=-1,c.contentStored="",c.content="",c.formatedContent="",c.t07txt=null,o.configWYSIWYG(c,e),r.list(c.params.cdItem).then(function(e){c.texts=e.data.data,c.selectedIndex=0}),e.$watch("ctrl.selectedIndex",function(n,i){n!=i&&c.texts.length>0&&(t.loading=!0,c.t07txt=c.texts[n],r.getContent(c.t07txt.cdTexto).then(function(n){a.getAllExpressions().then(function(i){o.setContent(c,e,n.data.data[0].txConteudo),t.loading=!1})}))}),c.editClick=function(){c.contentStored=c.content,c.editing=!0},e.openDictionary=function(t){d.createWindow({scope:e,title:"Dictionary - "+t,width:"600px",height:"300px",position:d.POSITION.CENTER,buttons:[d.BUTTON.OK],htmlTemplate:'<dictionary-view expression="house" style="width:100%;height:100%;display:block;"></dictionary-view>',modal:!0}).show()},e.openPronunciation=function(e){alert("Pronunciation - "+e)}}),angular.module("VideoMdl").controller("VideoCtrl",function(e,t,n,i,r,o,a,s,d){var c=this;c.scope=e,e.name="VideoCtrl",e.params=t,c.cdItem=e.params.cdItem,c.commentaries="",c.initialCommentaries="",e.openDictionary=function(e){alert("dictionary")},e.openPronunciation=function(e){alert("Pronunciation - "+e)},r.configElementVideo(c,e.params.cdItem).then(function(e){c.t08vdo=e}),r.configGridSubtitles(c,e.params.cdItem),r.configWYSIWYG(c,e.params.cdItem),i.getAllExpressions().then(function(e){c.gridSubtitlesOptions.api.repaint()}),c.addSubtitleButtonClick=function(){o.add(e,c).then(function(e){c.gridSubtitlesOptions.api.reload().then(function(){c.gridSubtitlesOptions.api.findKey(e.cdItemSubtitle,{inLine:!0})})})},c.editSubtitleButtonClick=function(){o.edit(e,c).then(function(e){c.gridSubtitlesOptions.api.reload().then(function(){c.gridSubtitlesOptions.api.findKey(e.cdItemSubtitle,{inLine:!0})})})},c.delSubtitleButtonClick=function(){var e=c.gridSubtitlesOptions.api.getSelectedRow();a.del(e.cdItemSubtitle).then(function(){c.gridSubtitlesOptions.api.reload()})};var l=function(e){var t=c.gridSubtitlesOptions.api.getSelectedRow(),n=t.cdItemSubtitle;t.nrStart=t.nrStart+e,t.nrEnd=t.nrEnd+e,a.upd(n,t.nrStart,t.nrEnd,t.dsTexto).then(function(e){s.ghost("Subtitle","Subtitle time is update successfully"),c.gridSubtitlesOptions.api.repaint(),c.gridSubtitlesOptions.api.findKey(n,{inLine:!0})})};c.decreaseOneSecondButtonClick=function(){l(-1)},c.incrementOneSecondButtonClick=function(){l(1)},c.listenButtonClick=function(){var e=c.gridSubtitlesOptions.api.getSelectedRow();d.listenExpression(e.dsTexto)}}),angular.module("app").constant("AppConsts",{SERVER_URL:"https://denienglishsrv-denimar.rhcloud.com/"}),angular.module("app").constant("AppEnums",{CategoryType:{TEXT:275,VIDEO:276},Side:{LEFT:1,RIGHT:2}}),angular.module("app").config(function(e){e.when("/:cdCategoria?",{templateUrl:"src/app/components/home/home.htm",controller:"HomeCtrl",controllerAs:"ctrl"}).when("/text/:cdItem",{templateUrl:"src/app/components/text/text.htm",controller:"TextCtrl",controllerAs:"ctrl"}).when("/video/:cdItem",{templateUrl:"src/app/components/video/video.htm",controller:"VideoCtrl",controllerAs:"ctrl"}).otherwise({redirectTo:"/"})}),angular.module("app").service("AppSrv",function(e,t,n,i,r,o){var a=this;a.currentCategory=null,a.allExpressions=[],a.dictionaryExpressions=[],a.pronunciationExpressions=[],a.auxiliarMenu=[],a.createHamburgerButton=function(e,t){var n=$(document.createElement("button"));n.addClass("md-button"),n.addClass("md-icon-button"),n.addClass("md-ink-ripple");for(var r=0;r<e.length;r++){var o=e[r];n.attr(o,""),n.addClass(o)}var a=$(document.createElement("img"));a.attr("src","src/assets/images/hamburger.png"),a.addClass("hamburger-button"),n.append(a);var s=$("#md-toolbar-tools-main");t==i.Side.LEFT?s.prepend(n):s.append(n)},a.getNgRepeatTrackById=function(e){var t=Object.keys(e)[0];return e[t]},a.getConfigWYSIWYG=function(e,t){var n=function(t){var n=$.summernote.ui,i=n.button({contents:'<i class="glyphicon glyphicon-floppy-save"/>',tooltip:"save changes",click:function(){e()}});return i.render()},i=function(e){var n=$.summernote.ui,i=n.button({contents:'<i class="glyphicon glyphicon-remove"/>',tooltip:"cancel changes",click:function(){t()}});return i.render()};return{toolbar:[["saveOrCancelButtons",["saveButton","cancelButton"]],["fontsize",["fontname","fontsize","color"]],["style",["bold","italic","underline","clear"]],["para",["ul","ol","paragraph"]],["height",["height"]],["table",["table"]],["insert",["link","picture","video","hr"]],["view",["fullscreen","codeview"]]],buttons:{saveButton:n,cancelButton:i}}},a.requestWithPromise=function(t,i,a,s){var d=e.defer(),c={params:i},l=function(){n.get(r.SERVER_URL+t,c).then(function(e){if(!e.data.success)throw e.data.message;a&&o.ghost(a.title,a.message),d.resolve(e)})["catch"](function(e){e.data.message?o.error(e.data.message):o.error(e.data),d.reject(e)})};return s?o.confirm(s).then(function(e){"yes"===e.button&&l()}):l(),d.promise},a.requestWithPromisePayLoad=function(n,i,a,s,d){var c=e.defer(),l=function(){var e=t(r.SERVER_URL+n,i,{},{request:{method:"POST"}});e.save(a).$promise.then(function(e){e.success?(s&&o.ghost(s.title,s.message),c.resolve(e)):(o.error(e.message),c.reject(e))})["catch"](function(e){e.message?o.error(e.message):e.data?e.data.message?o.error(e.data.message):o.error(e.data):o.error("Inespected Error!"),c.reject(e)})};return d?w2confirm(d,function(e){"Yes"===e&&l()}):l(),c.promise},a.getDataURLImagemObjeto=function(e,t,n,i){var r=0,o=0;e instanceof HTMLImageElement?(r=e.naturalWidth,o=e.naturalHeight):(r=e.videoWidth,o=e.videoHeight);var a=document.createElement("canvas"),s=t,d=n,c=1;o>r?(c=s/r,d=c*o):(c=d/o,s=c*r),a.width=s,a.height=d;var l=a.getContext("2d");return l.drawImage(e,0,0,r,o,0,0,s,d),a.toDataURL("image/png",i)},a.listenExpression=function(e,t){if(event.ctrlKey&&event.shiftKey){var n="http://www.wordreference.com/enpt/";window.open(n+e)}else{var i=new SpeechSynthesisUtterance;i.text=e,i.lang="en-US",i.rate=.8,i.onstart=function(e){},i.onend=function(e){t&&t()},speechSynthesis.speak(i)}}}),angular.module("app").controller("AppCtrl",function(e,t,n,i,r,o){e.$route=n,e.$location=r,e.$routeParams=i,t.loading=!1});