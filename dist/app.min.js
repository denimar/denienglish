angular.module("TextMdl",[]),angular.module("VideoMdl",[]),angular.module("app",["ngRoute","TextMdl","VideoMdl","ngMaterial","ngResource","ngMessages","ngSanitize","material.svgAssetsCache","ui-deni-grid","uiDeniModalMdl","com.2fdevs.videogular","com.2fdevs.videogular.plugins.controls","info.vietnamcode.nampnq.videogular.plugins.youtube","summernote"]),angular.module("app").config(function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|javascript):/)}),angular.module("app").constant("DictionaryModalEnums",{SearchState:{STOPPED:0,SEARCHING:1,SEARCHED:2,ADDING:3,ADDED:4}}),angular.module("app").constant("PronunciationModalEnums",{SearchState:{STOPPED:0,SEARCHING:1,SEARCHED:2,ADDING:3,ADDED:4}}),angular.module("app").service("DictionaryRestSrv",function(e){var t=this;t.list=function(){return e.requestWithPromise("dictionary/list")},t.add=function(t,n){var i={title:"Inserting",message:"Expression added successfully!"};return e.requestWithPromise("dictionary/add",{ds_expressao:t,ds_tags:n},i)},t.del=function(t){var n={title:"Deleting",message:"Expression deleted successfully!"};return e.requestWithPromise("dictionary/del",{cd_dicionario:t},n,"Confirm deleting?")},t.learnedToogle=function(t){var n={title:"Updating",message:"Expression updated successfully!"};return e.requestWithPromise("dictionary/learned/toogle",{cd_dicionario:t},n)},t.definitionSet=function(t,n){var i={title:"Updating",message:"Expression updated successfully!"};return e.requestWithPromisePayLoad("dictionary/definition/set",{},{cd_dicionario:t,tx_definicao:n},i)},t.definitionGet=function(t){return e.requestWithPromise("dictionary/definition/get",{cd_dicionario:t})}}),angular.module("app").service("dictionarySrv",function(e,t,n,i){var o=this;o.list=function(){return t.list()},o.add=function(e,n){return t.add(e,n)},o.del=function(e){return t.del(e)},o.learnedToogle=function(e){return t.learnedToogle(e)},o.definitionSet=function(e,n){return t.definitionSet(e,n)},o.definitionGet=function(n){var i=e.defer();return t.definitionGet(n).then(function(e){i.resolve(e.data.data[0].txDefinicao)}),i.promise},o.openDictionaryDefinitionView=function(e,t){i.createWindow({scope:e,title:"Dictionary",width:"750px",height:"400px",position:i.POSITION.CENTER,buttons:[i.BUTTON.OK],htmlTemplate:'<dictionary-definition-view cd-dicionario="'+t+'"></dictionary-definition-view>',modal:!0}).show()}}),angular.module("app").service("categoryRestSrv",function(e){var t=this;t.add=function(t,n){var i={title:"Adding",message:"Category added successfully!"};return e.requestWithPromise("category/add",{cd_categoria_pai:t,ds_categoria:n},i)},t.rename=function(t,n){var i={title:"Editing",message:"Category renamed successfully!"};return e.requestWithPromise("category/upd",{cd_categoria:t,ds_categoria:n},i)},t.del=function(t){var n={title:"Deleting",message:"Category deleted successfully!"};return e.requestWithPromise("category/del",{cd_categoria:t},n,"Confirm deleting?")}}),angular.module("app").service("categorySrv",function(e,t,n){var i=this;i.add=function(i,o){var r=e.defer();return n.prompt("New Category","Enter a descrption of the category","",!0,i).then(function(e){t.add(o,e).then(function(e){r.resolve(e.data.data[0])})}),r.promise},i.rename=function(i,o,r){var a=e.defer();return n.prompt("Renaming Category","Enter a descrption of the category",r,!0,i).then(function(e){t.rename(o,e).then(function(e){a.resolve(e.data.data[0].dsCategoria)})}),a.promise},i.del=function(e){return t.del(e)}}),angular.module("app").service("ItemRestSrv",function(e){var t=this;t.list=function(t){return e.requestWithPromise("item/list",{cd_categoria:t})},t.get=function(t){return e.requestWithPromise("item/get",{cd_item:t})},t.add=function(t,n,i,o){var r={title:"Inserting",message:"Item added successfully!"};return e.requestWithPromisePayLoad("item/add",{topCategoryNode:t,cd_categoria:n,ds_item:i},{bt_imagem:o},r)},t.upd=function(t,n,i,o){var r={title:"Updating",message:"Item updated successfully!"};return e.requestWithPromisePayLoad("item/upd",{cd_item:t,cd_categoria:n,ds_item:i},{bt_imagem:o},r)},t.del=function(t){var n={title:"Deleting",message:"Item deleted successfully!"};return e.requestWithPromise("item/del",{cd_item:t},n,"Confirm deleting?")},t.favorite={set:function(t,n){return e.requestWithPromise("item/favorite/set",{cd_item:t,bl_favorite:n})},get:function(t){return e.requestWithPromise("item/favorite/get",{cd_item:t})}}}),angular.module("app").service("itemSrv",function(e,t,n,i,o,r,a,c,s){var l=this,d=function(e){var r=t.defer(),c=o.createWindowDescriptionMoreImage();return c.show().then(function(e){if("ok"==e.button){var t=i.getDataURLImagemObjeto(e.data.imageEl.get(0),150,150,.5);n.add(a.CategoryType.TEXT,i.currentCategory,e.data.description,t).then(function(e){r.resolve(e)})}else r.reject()}),r.promise},u=function(n){var o=t.defer();return n.newVideoItemModal={canShowImagePreview:!1,tp_video:0},n.newVideoItemModal.getImagePreviewUrl=function(){return n.newVideoItemModal.canShowImagePreview=n.newVideoItemModal.id_video&&(0==n.newVideoItemModal.tp_video&&11==n.newVideoItemModal.id_video.length||1==n.newVideoItemModal.tp_video&&28==n.newVideoItemModal.id_video.length),n.newVideoItemModal.canShowImagePreview?s.SERVER_URL+"item/image/getlink?tp_video="+n.newVideoItemModal.tp_video+"&id_video="+n.newVideoItemModal.id_video:null},r.showModal(n).then(function(t){e.loading=!0,c.add(i.currentCategory,n.newVideoItemModal.tp_video,n.newVideoItemModal.id_video,n.newVideoItemModal.description).then(function(t){o.resolve(t),e.loading=!1})}),o.promise};l.add=function(e,t){return t==a.CategoryType.TEXT?d(e):u(e)},l.del=function(e){return n.del(e)},l.favorite={set:function(e,i){var o=t.defer();return n.favorite.set(e,i).then(function(e){o.resolve(e.data.data[0].blFavorite)},function(e){o.reject(e)}),o.promise},get:function(e){var i=t.defer();return n.favorite.get(e).then(function(e){i.resolve(e.data.data[0].blFavorite)},function(e){i.reject(e)}),i.promise}}}),angular.module("app").service("PronunciationRestSrv",function(e){var t=this;t.list=function(){return e.requestWithPromise("pronunciation/list")},t.add=function(t){var n={title:"Inserting",message:"Expression added successfully!"};return e.requestWithPromise("pronunciation/add",{ds_expressao:t},n)},t.del=function(t){var n={title:"Deleting",message:"Expression deleted successfully!"};return e.requestWithPromise("pronunciation/del",{cd_pronuncia:t},n,"Confirm deleting?")},t.learnedToogle=function(t){var n={title:"Updating",message:"Expression updated successfully!"};return e.requestWithPromise("pronunciation/learned/toogle",{cd_pronuncia:t},n)}}),angular.module("app").service("pronunciationSrv",function(e,t){this.listenExpression=function(n){var i=e.defer();try{if(event.ctrlKey&&event.shiftKey){var o="http://www.wordreference.com/enpt/";t.open(o+n)}else var r=setInterval(function(){var e=speechSynthesis.getVoices();if(0!==e.length){clearInterval(r);var t=new SpeechSynthesisUtterance;t.text=n,t.lang="en-US";for(var o=0;o<e.length;o++)if(e[o].lang==t.lang){t.voice=e[o];break}t.rate=.8,t.onstart=function(e){},t.onend=function(e){i.resolve()},speechSynthesis.speak(t)}},200)}catch(a){i.reject(a)}return i.promise}}),angular.module("app").service("RevisionRestSrv",function(e){var t=this;t.getItemInfo=function(t){return e.requestWithPromise("revision/item/info",{cd_item:t})},t.getExpressions=function(t){return e.requestWithPromise("revision/expressions/get",{cd_item:t})},t.setLevelOfLearning=function(t,n,i){return e.requestWithPromise("revision/expressions/levelOfLearning/set",{cd_dicionario:t,cd_pronuncia:n,nr_level_of_learning:i})},t.markAsReviewed=function(t){return e.requestWithPromise("revision/markasreviewed",{cd_item:t})}}),angular.module("app").service("revisionSrv",function(e,t){var n=this;n.getItemInfo=function(n){var i=e.defer();return t.getItemInfo(n).then(function(e){var t=e.data.data[0];i.resolve(t)},function(e){i.reject(e)}),i.promise},n.getExpressions=function(n){var i=e.defer();return t.getExpressions(n).then(function(e){var t=e.data.data;i.resolve(t)},function(e){i.reject(e)}),i.promise},n.setLevelOfLearning=function(n,i,o){var r=e.defer();return t.setLevelOfLearning(n,i,o).then(function(e){var t=e.data.data[0];r.resolve(t)},function(e){r.reject(e)}),r.promise}}),angular.module("app").service("DatabaseSrv",function(){}),angular.module("app").service("GeneralSrv",function(e,t,n,i,o,r){var a=this;a.getAllExpressions=function(){var t=e.defer();return i.list().then(function(e){r.dictionaryExpressions=e.data.data,o.list().then(function(e){r.pronunciationExpressions=e.data.data,r.allExpressions=r.dictionaryExpressions.concat(r.pronunciationExpressions),t.resolve(r.allExpressions)},function(e){console.error(e)})},function(e){console.error(e)}),t.promise},a.insertHtmlWithController=function(e,t,i,o){e.html("");var r=$("<div>"+t+"</div>");n(r)(o),e.append(r)}}),angular.module("app").service("StringSrv",function(e){var t=this;t.format=function(){for(var e=arguments[0],t=1;t<arguments.length;t++){var n=new RegExp("\\{"+(t-1).toString()+"\\}","gi");e=e.replace(n,arguments[t])}return e},t.leftPad=function(e,t,n){var i=t-e.toString().length+1;return Array(+(i>0&&i)).join(n)+e},t.replaceAll=function(e,t,n){return e?e.replace(RegExp("\\b"+t+"\\b","g"),n):""},t.doubleToStrTime=function(e){var n=3600,i=60,o=e/n,r=t.leftPad(Math.floor(o),2,"0"),a=e/i,c=t.leftPad(Math.floor(a),2,"0"),s=(e%i).toString(),l="000",d=s.indexOf(".");return d!=-1&&(l=s.substring(d+1).substring(0,3),l+="0".repeat(3-l.length),s=s.substring(0,d)),s=t.leftPad(Math.floor(s),2,"0")+","+l,r+":"+c+":"+s},t.strTimeToDouble=function(e){var t=e,n=parseInt(t.substring(0,2)),i=parseInt(t.substring(3,5));t=t.substring(6,t.length).replace(",",".");var o=parseFloat(t);return 3600*n+60*i+o},t.addLinksDictionaryAndPronunciation=function(n){var i=e.allExpressions;if(0==i.length)return n;for(var o=t.replaceAll(n,'"',"'"),r=o.toLowerCase(),a="matrizsubst1-{0}-matrizsubst2",c=[],s=0,l=0;l<i.length;l++)for(var d=i[l],u=d.dsExpressao.toLowerCase(),p=r.search(new RegExp("\\b"+u+"\\b"));p!=-1;){var f=o.substring(p,p+u.length);if(f.toLowerCase()==u){c.push({cd_pronuncia:d.cdPronuncia,cd_dicionario:d.cdDicionario,ds_expressao:d.dsExpressao,texto:f});var m=t.format(a,s);o=o.replace(new RegExp("\\b"+f+"\\b","g"),m),s++,r=o.toLowerCase()}p=r.search(new RegExp("\\b"+u+"\\b"))}for(var l=0;l<c.length;l++){var d=c[l],g=t.format(a,l),h=null,v=null,S=null;d.cd_dicionario?(v="openDictionary("+d.cd_dicionario+");",S="dictionary-link"):(v="openPronunciation('"+d.ds_expressao.trim()+"');",S="pronunciation-link"),h=t.format('<span class="'+S+'" ng-click="'+v+'">'+d.ds_expressao+"</span>",t.replaceAll(d.ds_expressao,"'","\\'"),t.replaceAll(d.texto,"'","\\'")),o=t.replaceAll(o,g,h)}return o}}),angular.module("app").service("dictionaryModalSrv",function(e,t,n,i,o,r){var a=this;a.controller,a.setController=function(e){a.controller=e},a.showModal=function(n){var o=e.defer();return t.createWindow({scope:n,title:"Dictionary",width:"700px",height:"580px",position:t.POSITION.CENTER,buttons:[t.BUTTON.OK],urlTemplate:"src/app/shared/dictionary/dictionary-modal/dictionary-modal.tpl.htm",modal:!0,listeners:{onshow:function(e){}}}).show().then(function(){i.allExpressions=i.pronunciationExpressions.concat(a.controller.gridDictionaryOptions.alldata),o.resolve(a.controller.gridDictionaryOptions.alldata)}),o.promise},a.getGridDictionaryOptions=function(){return{keyField:"cdDicionario",rowHeight:"25px",url:o.SERVER_URL+"dictionary/list",hideHeaders:!0,columns:[{name:"dsExpressao",width:"40%"},{name:"dsTags",width:"40%"},{width:"10%",action:{mdIcon:"edit",tooltip:"Edit the current expression",fn:function(e,t,n){alert("edit")}}},{width:"10%",action:{mdIcon:"delete_forever",tooltip:"Remove a expression from dictionary",fn:function(e,t,n){r.del(e.cdDicionario).then(function(e){a.controller.gridDictionaryOptions.api.reload()})}}}],listeners:{onselectionchange:function(e,t,n,i){var o=$(".dictionary-modal .dictionary-definition-view"),t=angular.element(o),r=t.scope();r.$$childTail.ctrl.cdDicionario=i.cdDicionario,r.$$phase||r.$apply()},onbeforeload:function(){var e=$(".dictionary-modal .dictionary-definition-view"),t=angular.element(e),n=t.scope();n.$$childTail.ctrl.cdDicionario=null},onresolveinputeditor:function(e){alert("edited")}}}},a.searchInputChange=function(){a.controller.searchState=n.SearchState.SEARCHING},a.searchInputKeydown=function(){13==event.keyCode&&(a.controller.searchState==n.SearchState.SEARCHING?a.searchButtonClick(a.controller):a.controller.searchState==n.SearchState.SEARCHED&&a.searchButtonAddClick())},a.showSearchButton=function(e){return"search"==e&&a.controller.searchState==n.SearchState.SEARCHING||"add"==e&&a.controller.searchState==n.SearchState.SEARCHED},a.searchButtonClick=function(){a.controller.searchState=n.SearchState.SEARCHED;var e=$(".dictionary-modal .search-input");a.controller.gridDictionaryOptions.api.filter(e.val())},a.searchButtonAddClick=function(){a.controller.searchState=n.SearchState.ADDED;var e=$(".dictionary-modal .search-input");r.add(e.val(),"").then(function(e){a.controller.gridDictionaryOptions.api.reload(),a.controller.searchState=n.SearchState.STOPPED})},a.showLoading=function(){return a.controller.searchState==n.SearchState.ADDED}}),angular.module("app").service("newVideoItemModalSrv",function(e,t){var n=this;n.showModal=function(n){var i=e.defer(),o=t.createWindow({scope:n,title:"Creating a new video",width:"550px",height:"300px",position:t.POSITION.CENTER,buttons:[t.BUTTON.OK,t.BUTTON.CANCEL],urlTemplate:"src/app/shared/item/new-video-item-modal/new-video-item-modal.tpl.htm",modal:!0,listeners:{onshow:function(e){n.newVideoItemModal.kindOfVideo=0}}});return o.show().then(function(e){"ok"==e.button?i.resolve(n.newVideoItemModal):i.reject()}),i.promise}}),angular.module("app").service("pronunciationModalSrv",function(e,t,n,i,o,r,a){var c=this;c.controller,c.setController=function(e){c.controller=e},c.showModal=function(i){var o=e.defer();return n.createWindow({scope:i,title:"Pronunciation",width:"550px",height:"450px",position:n.POSITION.CENTER,buttons:[n.BUTTON.OK],urlTemplate:"src/app/shared/pronunciation/pronunciation-modal/pronunciation-modal.tpl.htm",modal:!0,listeners:{onshow:function(e){}}}).show().then(function(){t.allExpressions=t.dictionaryExpressions.concat(c.controller.gridPronunciationOptions.alldata),o.resolve(c.controller.gridPronunciationOptions.alldata)}),o.promise},c.getGridPronunciationOptions=function(){return{keyField:"cdPronuncia",rowHeight:"25px",url:o.SERVER_URL+"pronunciation/list",hideHeaders:!0,columns:[{name:"dsExpressao",width:"80%"},{width:"10%",action:{mdIcon:"headset",tooltip:"Listen the selected expression",fn:function(e,t,n){a.listenExpression(e.dsExpressao)}}},{width:"10%",action:{mdIcon:"delete_forever",tooltip:"Remove a expression from pronunciation",fn:function(e,t,n){r.del(e.cdPronuncia).then(function(e){c.controller.gridPronunciationOptions.api.reload()})}}}]}},c.searchInputChange=function(){c.controller.searchState=i.SearchState.SEARCHING},c.searchInputKeydown=function(){13==event.keyCode&&(c.controller.searchState==i.SearchState.SEARCHING?c.searchButtonClick(c.controller):c.controller.searchState==i.SearchState.SEARCHED&&c.searchButtonAddClick())},c.showSearchButton=function(e){return"search"==e&&c.controller.searchState==i.SearchState.SEARCHING||"add"==e&&c.controller.searchState==i.SearchState.SEARCHED},c.searchButtonClick=function(){c.controller.searchState=i.SearchState.SEARCHED;var e=$(".pronunciation-modal .search-input");c.controller.gridPronunciationOptions.api.filter(e.val())},c.searchButtonAddClick=function(){c.controller.searchState=i.SearchState.ADDED;var e=$(".pronunciation-modal .search-input");r.add(e.val(),"").then(function(e){c.controller.gridPronunciationOptions.api.reload(),c.controller.searchState=i.SearchState.STOPPED})},c.showLoading=function(){return c.controller.searchState==i.SearchState.ADDED}}),angular.module("app").service("spacedRevisionSrv",function(e,t,n,i,o,r,a,c){var s=this;s.controller,s.setController=function(e){s.controller=e},s.selectExpression=function(e){s.controller.showDefinitionContent=!1,s.controller.expressions.length>0&&(s.controller.currentExpressionIndex=e,s.controller.currentExpression=s.controller.expressions[e],s.controller.model.expression.dsExpressao=s.controller.currentExpression.dsExpressao,s.controller.model.expression.type=0!=s.controller.currentExpression.cdDicionario?"Dictionary":"Pronuciation",s.controller.model.expression.resultType=0!=s.controller.currentExpression.cdDicionario?"menu":"volume_up",s.controller.model.expression.learnedRate=s.controller.currentExpression.nrLevelOfLearning,s.controller.model.expression.definition="")},s.showResult=function(e){if(0!=e.currentExpression.cdDicionario){event.ctrlKey&&o.listenExpression(e.model.expression.dsExpressao);var t=$(".spaced-revision-modal .definition-detail-content-content dictionary-definition-view"),n=angular.element(t),i=n.scope();i.$$childTail.ctrl.cdDicionario=e.currentExpression.cdDicionario,i.$$phase||i.$apply(),s.controller.showDefinitionContent=!0}else angular.isDefined(e.currentExpression.cdPronuncia)&&o.listenExpression(e.model.expression.dsExpressao)},s.updateLearnedPercentage=function(){for(var e=s.controller.element.find(".item-detail-data-progress-bar"),t=e.width(),n=0,i=0;i<s.controller.expressions.length;i++)n+=s.controller.expressions[i].nrLevelOfLearning;var o=n/s.controller.expressions.length;s.controller.model.learnedPercentage=o.toFixed(2);var r=s.controller.element.find(".item-detail-data-progress");r.width(t*o/100)},s.markAsReviewed=function(e){return r.markAsReviewed(e).then(function(){a.ghost("Spaced Revision","Item marked as reviewed successfuly!")})},s.showModal=function(i,o){e.selectedCdItem=o,c.getExpressions(o).then(function(i){a.createWindow({scope:e,title:"Spaced Revision",width:"900px",height:"600px",position:a.POSITION.CENTER,buttons:[a.BUTTON.OK],urlTemplate:"src/app/shared/spaced-revision/spaced-revision-modal/spaced-revision-modal.tpl.htm",modal:!0,listeners:{onshow:function(e){c.getItemInfo(o).then(function(r){s.controller.expressions=i,s.selectExpression(0),s.controller.element=$(e),s.updateLearnedPercentage(s.controller.expressions),s.controller.cdItem=o,s.controller.itemImage=t.format("{0}item/image/get?cd_item={1}&time={2}",n.SERVER_URL,o,(new Date).getMilliseconds()),s.controller.dsItem=r.dsItem,s.controller.dsBreadCrumbPath=r.dsBreadCrumbPath})}}}).show()})}}),angular.module("app").service("dictionaryDefinitionViewSrv",function(e){var t=this;t.cdDicionario=null,t.controller=null,t.setController=function(e){t.controller=e};var n=function(e){var n=t.controller.element.find(".definition");if(n.html(""),e){var i=$(document.createElement("div"));i.html(e),n.append(i)}};t.refreshDefinition=function(i){t.controller.currentDefinition="",n(""),t.cdDicionario=i,i&&e.definitionGet(i).then(function(e){if(e.data.total>0){var i=e.data.data[0];t.controller.currentDefinition=i.txDefinicao,n(t.controller.currentDefinition)}})},t.definitionEditClick=function(){t.controller.currentDefinitionBeforeEditing=t.controller.currentDefinition,t.controller.editingDefinition=!0},t.definitionSaveClick=function(){e.definitionSet(t.cdDicionario,t.controller.currentDefinition).then(function(e){t.controller.editingDefinition=!1,n(t.controller.currentDefinition)})},t.definitionCancelClick=function(){t.controller.currentDefinition=t.controller.currentDefinitionBeforeEditing,t.controller.editingDefinition=!1}}),angular.module("app").controller("DictionaryModalCtrl",function(e,t){e.setController(this),this.searchState=t.SearchState.STOPPED,this.searchValue="",this.gridDictionaryOptions=e.getGridDictionaryOptions(),this.searchInputChange=e.searchInputChange,this.searchInputKeydown=e.searchInputKeydown,this.searchButtonClick=e.searchButtonClick,this.searchButtonAddClick=e.searchButtonClick,this.showSearchButton=e.showSearchButton,this.showLoading=e.showLoading}),angular.module("app").controller("NewVideoItemModalCtrl",function(e){var t=this,n=function(e,t,n,i){var o=0,r=0;e instanceof HTMLImageElement?(o=e.naturalWidth,r=e.naturalHeight):(o=e.videoWidth,r=e.videoHeight);var a=document.createElement("canvas"),c=t,s=n,l=1;r>o?(l=c/o,s=l*r):(l=s/r,c=l*o),a.width=c,a.height=s;var d=a.getContext("2d");return d.drawImage(e,0,0,o,r,0,0,c,s),a.toDataURL("image/jpeg",i)};t.capturePosterFromVideo=function(){var e=$(".video-preview").get(0),t=n(e,150,150,.5);console.log(t)}}),angular.module("app").controller("PronunciationModalCtrl",function(e,t){e.setController(this),this.searchState=t.SearchState.STOPPED,this.searchValue="",this.gridPronunciationOptions=e.getGridPronunciationOptions(),this.searchInputChange=e.searchInputChange,this.searchInputKeydown=e.searchInputKeydown,this.searchButtonClick=e.searchButtonClick,this.searchButtonAddClick=e.searchButtonClick,this.showSearchButton=e.showSearchButton,this.showLoading=e.showLoading}),angular.module("app").controller("SpacedRevisionCtrl",function(e,t,n,i,o,r,a){var c=this;a.setController(c),c.showDefinitionContent=!1,c.learnedRate=60,c.expressions=[],c.currentExpression,c.currentExpressionIndex,c.model={expression:{}},c.model.navigatorStatus="",c.navigate=function(e){a.selectExpression(c.currentExpressionIndex+e)},c.navigateFirst=function(){a.selectExpression(0)},c.navigateLast=function(){a.selectExpression(c.expressions.length-1)},c.showResult=function(){a.showResult(c)},c.changeLearnedRate=function(){o.setLevelOfLearning(c.currentExpression.cdDicionario,c.currentExpression.cdPronuncia,c.model.expression.learnedRate),c.currentExpression.nrLevelOfLearning=c.model.expression.learnedRate,a.updateLearnedPercentage(c)},c.markAsReviewed=function(e){a.markAsReviewed(e),console.log("TODO: FAZER UMA ROTINA NA uiDeniModal para fechar a janela ativa..."),console.log("TODO: VERIFICAR TAMBÉM O UI-DENI-MODAL... PASSAGEM DO Scope...")}}),angular.module("app").controller("DictionaryDefinitionViewCtrl",function(e,t){t.setController(this),this.currentDefinition=null,this.editingDefinition=!1,this.definitionEditClick=t.definitionEditClick,this.definitionSaveClick=t.definitionSaveClick,this.definitionCancelClick=t.definitionCancelClick,e.$watch("ctrl.cdDicionario",function(e,n){t.refreshDefinition(e)})}),angular.module("app").directive("dictionaryDefinitionView",function(){return{restrict:"E",scope:{},bindToController:{cdDicionario:"=?"},controller:"DictionaryDefinitionViewCtrl",controllerAs:"ctrl",templateUrl:"src/app/shared/dictionary/directives/dictionary-definition-view/dictionary-definition-view.tpl.htm",link:function(e,t,n){e.ctrl.element=$(t)}}}),angular.module("app").service("homeSrv",function(e,t,n,i,o,r,a,c,s,l,d){var u=this,p=null;u.addCategoryClick=function(e,t){n.add(e,t).then(function(e){var n={state:"open",id:e.cdCategoria,text:e.dsCategoria,data:e};p.create_node(t,n,"last",function(e){p.deselect_all(),p.select_node(e)})})},u.editCategoryClick=function(e,t){n.rename(e,t.id,t.text).then(function(e){p.rename_node(t,e)})},u.delCategoryClick=function(e){n.del(e.id).then(function(t){var n=p.get_node(e.parent);p.delete_node([e]),p.select_node(n)})};var f=function(e){return"#"==e.currentCategoryNode.parent?e.currentCategoryNode.id:e.currentCategoryNode.parents[e.currentCategoryNode.parents.length-2]};u.addNewItemButtonClick=function(e,t,n){var i=f(e);r.add(t,i).then(function(t){e.gridOptions.api.reload().then(function(n){var i=t.data[0],o=i.cdItem||i.t05itm.cdItem;e.gridOptions.api.findKey(o,{inLine:!0})})})};var m=function(e,t){e.currentCategoryNode=t.node,o.currentCategory=e.currentCategoryNode.id;for(var n='<span class="categoryPathTitle">'+e.currentCategoryNode.text+"</span>",i=e.currentCategoryNode.parent;"#"!=i;){var r=t.instance.get_node(i);n=r.text+" / "+n;var i=r.parent}e.categoryPath=n};u.reloadDataGrid=function(e){e.currentCategoryNode&&("pageItems"==e.currentNavItem?e.gridOptions.url=i.SERVER_URL+"item/list?cd_categoria="+e.currentCategoryNode.id:"pageRevisions"==e.currentNavItem?e.gridOptions.url=i.SERVER_URL+"revision/list?pendente=true&days=5&cd_categoria="+e.currentCategoryNode.id:e.gridOptions.url=i.SERVER_URL+"item/favorite/get?cd_categoria="+e.currentCategoryNode.id,e.gridOptions.api.reload())},u.configureTreeView=function(e,t){$("#categoryTreeview").on("loaded.jstree",function(e,n){p=n.instance,t&&p.select_node(t)}).on("changed.jstree",function(t,n){n.node&&(m(e,n),u.reloadDataGrid(e))}).jstree({core:{check_callback:!0,data:{url:i.SERVER_URL+"category/category/tree/list",dataType:"json"}},plugins:["wholerow"]})},u.configureGridItems=function(n,u){n.gridOptions={hideHeaders:!0,colLines:!1,keyField:"cdItem",rowHeight:"100px",columns:[{header:"Item",name:"cdItem",width:"calc(100% - 96px)",renderer:function(e,t){var o=null,r=f(n);o=r==a.CategoryType.TEXT?"/text":"/video";var s=new Date,l=s.getMilliseconds(),d=t.blFavorite?"star":"star_border",u=t.blFavorite?"selected":"",p='<div class="cell-template">\n    <img class="item-image"\n        src="{0}item/image/get?cd_item={1}&time={5}" \n    />\n    <div><a href="#{2}/{1}">{3}</a></div>\n    <div>{4}</div>\n    <md-icon class="material-icons favorite {6}"> {7} </md-icon>\n<div>';return c.format(p,i.SERVER_URL,t.cdItem,o,t.dsItem,"blá blá blá blá",l,u,d)}},{width:"32px",action:{mdIcon:"restore",tooltip:"",fn:function(e,t,n){s.showModal(u,e.cdItem)}}},{width:"32px",action:{mdIcon:"edit",tooltip:"",fn:function(e,t,i){var r=$(i).closest(".ui-row"),a=r.find(".item-image"),c={description:e.dsItem,imgSrc:a.attr("src")},s=l.createWindowDescriptionMoreImage(c);s.show().then(function(t){if("ok"==t.button){var i=o.getDataURLImagemObjeto(t.data.imageEl.get(0),160,140,1);d.upd(e.cdItem,o.currentCategory,t.data.description,i).then(function(e){n.gridOptions.api.reload().then(function(i){a.attr("src",t.data.image);var o=e.data[0].cdItem;n.gridOptions.api.findKey(o,{inLine:!0})})})}})}}},{width:"32px",action:{mdIcon:"delete_forever",tooltip:"",fn:function(e,t,i){r.del(e.cdItem).then(function(){n.gridOptions.api.reload()})}}}],listeners:{onbeforeload:function(e,n){t.subTitle=""},onafterrepaintrow:function(t,i){e(function(){i.find(".material-icons.favorite").click(function(e){var t=n.gridOptions.api.getSelectedRow();r.favorite.set(t.cdItem,!t.blFavorite).then(function(e){t.blFavorite=e,n.gridOptions.api.repaintSelectedRow()})})},500)},onselectionchange:function(e,n,i,o){t.subTitle=o.dsItem,u.$$phase||u.$apply()}}}}}),angular.module("app").service("TextRestSrv",function(e){var t=this;t.list=function(t){return e.requestWithPromise("text/list",{cd_item:t})},t.getContent=function(t){return e.requestWithPromise("text/content/get",{cd_texto:t})},t.setContent=function(t,n){var i={title:"Texts",message:"text updated successfully!"};return e.requestWithPromisePayLoad("text/content/set",{},{cd_texto:t,tx_conteudo:n},i)}}),angular.module("TextMdl").service("TextSrv",function(e,t,n,i){var o=this;o.setContent=function(e,t,o){var r=$(".text .text-content");e.content=o,e.formatedContent=n.addLinksDictionaryAndPronunciation(e.content),i.insertHtmlWithController(r,e.formatedContent,"TextCtrl",t)}}),angular.module("app").service("VideoRestSrv",function(e){var t=this;t.add=function(t,n,i,o){var r={title:"Videos",message:"Video added successfully!"};return e.requestWithPromisePayLoad("video/add",{},{cd_categoria:t,tp_video:n,id_video:i,ds_item:o},r)},t.get=function(t){return e.requestWithPromise("video/get",{cd_item:t})},t.commentaries={set:function(t,n){var i={title:"Videos",message:"commentary updated successfully!"};return e.requestWithPromisePayLoad("video/commentary/set",{cd_video:t},{txCommentaries:n},i)}}}),angular.module("VideoMdl").service("VideoSrv",function(e,t,n,i,o,r,a,c,s){var l=this,d=function(e,t){for(var n=e.gridSubtitlesOptions.data,i=0;i<n.length;i++){var o=n[i];if(t>=o.nrStart&&t<=o.nrEnd){i!=e.gridSubtitlesOptions.api.getSelectedRowIndex()&&e.gridSubtitlesOptions.api.selectRow(i,!0,!1);break}}},u=!1;l.configElementVideo=function(e,n){var a=o.defer();return e.onPlayerReady=function(t){e.videoAPI=t,e.videoAPI.autoPlay=!1;var n=i(function(){angular.isDefined(e.currentTime)&&i.cancel(n)},1e3)},e.onUpdateTime=function(t,n){e.currentTime=1e3*t,e.totalTime=1e3*n,e.timeLeft=e.totalTime-e.currentTime,u||d(e,t)},r.get(n).then(function(n){var i=n.data.data[0];a.resolve(i);"YOUTUBE"==i.tpVideo?urlImage="https://www.youtube.com/watch?v="+i.idVideo:urlImage="https://googledrive.com/host/"+i.idVideo,e.videoConfig={autoPlay:!1,sources:[{src:t.trustAsResourceUrl(urlImage),type:"video/mp4"}],theme:{url:"dist/videogular/videogular.css"},plugins:{controls:{autoHide:!0,autoHideTime:5e3}}}}),a.promise},l.configGridSubtitles=function(t,i){t.gridSubtitlesOptions={keyField:"cdItemSubtitle",rowHeight:"37px",url:a.SERVER_URL+"/subtitle/list?cd_item="+i,hideHeaders:!0,columns:[{name:"nrStart",width:"15%",align:"center",renderer:function(e,t){return c.doubleToStrTime(e)}},{name:"nrEnd",width:"15%",align:"center",renderer:function(e,t){return c.doubleToStrTime(e)}},{name:"dsTexto",width:"80%",renderer:function(e,i){var o=$("<div>"+c.addLinksDictionaryAndPronunciation(e)+"</div>");return n(o)(t.scope),o}}],listeners:{onselectionchange:function(n,i,o,r){u=!0;try{t.videoAPI.seekTime(r.nrStart)}finally{e(function(){u=!1},1500)}}}}},l.configWYSIWYG=function(e,t){var n=function(){r.commentaries.set(e.t08vdo.cdVideo,e.t08vdo.txComentarios)},i=function(){r.get(t).then(function(t){e.t08vdo=t.data.data[0]})};e.options=s.getConfigWYSIWYG(n,i)}}),angular.module("app").service("SubtitleRestSrv",function(e){var t=this;t.list=function(t){return e.requestWithPromise("subtitle/list",{cd_item:t})},t.add=function(t,n,i,o){var r={title:"Inserting",message:"Subtitle added successfully!"};return e.requestWithPromisePayLoad("subtitle/add",{},{cd_video:t,nr_start:n,nr_end:i,ds_texto:o},r)},t.upd=function(t,n,i,o){var r={title:"Updating",message:"Subtitle updated successfully!"};return e.requestWithPromisePayLoad("subtitle/upd",{},{cd_item_subtitle:t,nr_start:n,nr_end:i,ds_texto:o},r)},t.del=function(t){var n={title:"Deleting",message:"Subtitle deleted successfully!"};return e.requestWithPromise("subtitle/del",{cd_item_subtitle:t},n,"Confirm deleting?")}}),angular.module("VideoMdl").service("subtitleModalSrv",function(e,t,n,i){var o=this,r={ADDING:1,EDITING:2},a=function(o,a,c){var s=e.defer();a.subtitleModalData={};var l=a.gridSubtitlesOptions.api.getSelectedRow();if(c==r.EDITING){var l=a.gridSubtitlesOptions.api.getSelectedRow();a.subtitleModalData.start=n.doubleToStrTime(l.nrStart),a.subtitleModalData.end=n.doubleToStrTime(l.nrEnd),a.subtitleModalData.text=l.dsTexto}else l&&(a.subtitleModalData.start=n.doubleToStrTime(l.nrStart+1),a.subtitleModalData.end=n.doubleToStrTime(l.nrStart+2));var d=t.createWindow({scope:o,title:"Subtitles",width:"450px",height:"230px",position:t.POSITION.CENTER,buttons:[t.BUTTON.OK,t.BUTTON.CANCEL],urlTemplate:"src/app/components/video/subtitle/modals/subtitle-modal.tpl.htm",modal:!0,listeners:{onshow:function(e){}}});return d.show().then(function(e){if("ok"==e.button){a.subtitleModalData.start=n.strTimeToDouble(a.subtitleModalData.start),a.subtitleModalData.end=n.strTimeToDouble(a.subtitleModalData.end),console.log(a.subtitleModalData),c==r.EDITING?i.upd(l.cdItemSubtitle,a.subtitleModalData.start,a.subtitleModalData.end,a.subtitleModalData.text).then(function(e){s.resolve(e.data[0])}):i.add(a.t08vdo.cdVideo,a.subtitleModalData.start,a.subtitleModalData.end,a.subtitleModalData.text).then(function(e){s.resolve(e.data[0])})}else s.reject("")}),s.promise};o.add=function(e,t){return a(e,t,r.ADDING)},o.edit=function(e,t){return a(e,t,r.EDITING)}}),angular.module("app").controller("HomeCtrl",function(e,t,n,i,o,r){var a=this;a.categoryPath=null,r.createHamburgerButton(["show-xs","hide-gt-xs"],o.Side.LEFT),a.currentNavItem="pageItems",a.currentCategoryNode=null,$.jstree.defaults.core.themes.variant="large",a.addCategoryClick=function(){i.addCategoryClick(e,a.currentCategoryNode.id);
},a.editCategoryClick=function(){i.editCategoryClick(e,a.currentCategoryNode)},a.delCategoryClick=function(){i.delCategoryClick(a.currentCategoryNode)},a.addNewItemButtonClick=function(t){i.addNewItemButtonClick(a,e,t)},i.configureTreeView(a,r.currentCategory||n.cdCategoria),i.configureGridItems(a,e),e.$watch("ctrl.currentNavItem",function(e,t){a.currentNavItem=e,e&&i.reloadDataGrid(a)})}),angular.module("TextMdl").controller("TextCtrl",function(e,t,n,i,o,r,a,c,s,l,d,u,p){var f=this;f.editing=!1,f.params=n,f.texts=[],f.selectedIndex=-1,f.contentStored="",f.content="",f.formatedContent="",f.t07txt=null,s.list(f.params.cdItem).then(function(e){f.texts=e.data.data,f.selectedIndex=0}),f.dictionaryModalClick=function(){o.showModal(t).then(function(t){l.setContent(f,e,f.content)})},f.pronunciationModalClick=function(){a.showModal(t).then(function(t){l.setContent(f,e,f.content)})},e.$watch("ctrl.selectedIndex",function(n,i){angular.isDefined(n)&&n!==i&&f.texts.length>0&&(t.loading=!0,f.t07txt=f.texts[n],s.getContent(f.t07txt.cdTexto).then(function(n){d.getAllExpressions().then(function(i){l.setContent(f,e,n.data.data[0].txConteudo),t.loading=!1})}))}),f.editClick=function(){f.contentStored=f.content,f.editing=!0},f.saveClick=function(){s.setContent(f.t07txt.cdTexto,f.content).then(function(t){l.setContent(f,e,t.data[0].txConteudo),f.editing=!1})},f.cancelClick=function(){f.content=f.contentStored,f.editing=!1},f.listenSelectedTextClick=function(){var e=window.getSelection();e&&r.listenExpression(e.toString().trim())},e.openDictionary=function(e){i.openDictionaryDefinitionView(t,e)},e.openPronunciation=function(e){r.listenExpression(e)}}),angular.module("VideoMdl").controller("VideoCtrl",function(e,t,n,i,o,r,a,c,s,l,d,u,p,l){var f=this;f.scope=e,e.name="VideoCtrl",e.params=n,f.cdItem=e.params.cdItem,f.commentaries="",f.initialCommentaries="",r.configElementVideo(f,e.params.cdItem).then(function(e){f.t08vdo=e}),r.configGridSubtitles(f,e.params.cdItem),r.configWYSIWYG(f,e.params.cdItem),o.getAllExpressions().then(function(e){f.gridSubtitlesOptions.api.repaint()}),f.dictionaryModalClick=function(){p.showModal(t).then(function(e){f.gridSubtitlesOptions.api.repaint()})},f.pronunciationModalClick=function(){d.showModal(t).then(function(e){f.gridSubtitlesOptions.api.repaint()})},f.addSubtitleButtonClick=function(){a.add(e,f).then(function(e){f.gridSubtitlesOptions.api.reload().then(function(){f.gridSubtitlesOptions.api.findKey(e.cdItemSubtitle,{inLine:!0})})})},f.editSubtitleButtonClick=function(){a.edit(e,f).then(function(e){f.gridSubtitlesOptions.api.reload().then(function(){f.gridSubtitlesOptions.api.findKey(e.cdItemSubtitle,{inLine:!0})})})},f.delSubtitleButtonClick=function(){var e=f.gridSubtitlesOptions.api.getSelectedRow();c.del(e.cdItemSubtitle).then(function(){f.gridSubtitlesOptions.api.reload()})};var m=function(e){var t=f.gridSubtitlesOptions.api.getSelectedRow(),n=t.cdItemSubtitle;t.nrStart=t.nrStart+e,t.nrEnd=t.nrEnd+e,c.upd(n,t.nrStart,t.nrEnd,t.dsTexto).then(function(e){s.ghost("Subtitle","Subtitle time is update successfully"),f.gridSubtitlesOptions.api.repaint(),f.gridSubtitlesOptions.api.findKey(n,{inLine:!0})})};f.decreaseOneSecondButtonClick=function(){m(-1)},f.incrementOneSecondButtonClick=function(){m(1)},f.listenButtonClick=function(){var e=f.gridSubtitlesOptions.api.getSelectedRow();l.listenExpression(e.dsTexto)},e.openDictionary=function(e){u.openDictionaryDefinitionView(t,e)},e.openPronunciation=function(e){l.listenExpression(e)}}),angular.module("app").constant("AppConsts",{SERVER_URL:"https://denienglishsrv-denimar.rhcloud.com/"}),angular.module("app").constant("AppEnums",{CategoryType:{TEXT:275,VIDEO:276},Side:{LEFT:1,RIGHT:2}}),angular.module("app").config(function(e){e.when("/:cdCategoria?",{templateUrl:"src/app/components/home/home.htm",controller:"HomeCtrl",controllerAs:"ctrl"}).when("/text/:cdItem",{templateUrl:"src/app/components/text/text.htm",controller:"TextCtrl",controllerAs:"ctrl"}).when("/video/:cdItem",{templateUrl:"src/app/components/video/video.htm",controller:"VideoCtrl",controllerAs:"ctrl"}).otherwise({redirectTo:"/"})}),angular.module("app").service("AppSrv",function(e,t,n,i,o,r){var a=this;a.currentCategory=null,a.allExpressions=[],a.dictionaryExpressions=[],a.pronunciationExpressions=[],a.auxiliarMenu=[],a.createHamburgerButton=function(e,t){var n=$(document.createElement("button"));n.addClass("md-button"),n.addClass("md-icon-button"),n.addClass("md-ink-ripple");for(var o=0;o<e.length;o++){var r=e[o];n.attr(r,""),n.addClass(r)}var a=$(document.createElement("img"));a.attr("src","src/assets/images/hamburger.png"),a.addClass("hamburger-button"),n.append(a);var c=$("#md-toolbar-tools-main");t===i.Side.LEFT?c.prepend(n):c.append(n)},a.getNgRepeatTrackById=function(e){var t=Object.keys(e)[0];return e[t]},a.getConfigWYSIWYG=function(e,t){var n=function(){var t=$.summernote.ui,n=t.button({contents:'<i class="glyphicon glyphicon-floppy-save"/>',tooltip:"save changes",click:function(){e()}});return n.render()},i=function(){var e=$.summernote.ui,n=e.button({contents:'<i class="glyphicon glyphicon-remove"/>',tooltip:"cancel changes",click:function(){t()}});return n.render()};return{toolbar:[["saveOrCancelButtons",["saveButton","cancelButton"]],["fontsize",["fontname","fontsize","color"]],["style",["bold","italic","underline","clear"]],["para",["ul","ol","paragraph"]],["height",["height"]],["table",["table"]],["insert",["link","picture","video","hr"]],["view",["fullscreen","codeview"]]],buttons:{saveButton:n,cancelButton:i}}},a.requestWithPromise=function(t,i,a,c){var s=e.defer(),l=function(){var e={params:i};n.get(o.SERVER_URL+t,e).then(function(e){if(!e.data.success)throw e.data.message;a&&r.ghost(a.title,a.message),s.resolve(e)})["catch"](function(e){e.data.message?r.error(e.data.message):r.error(e.data),s.reject(e)})};return c?r.confirm(c).then(function(e){"yes"===e.button&&l()}):l(),s.promise},a.requestWithPromisePayLoad=function(n,i,a,c,s){var l=e.defer(),d=function(){var e=t(o.SERVER_URL+n,i,{},{request:{method:"POST"}});e.save(a).$promise.then(function(e){e.success?(c&&r.ghost(c.title,c.message),l.resolve(e)):(r.error(e.message),l.reject(e))})["catch"](function(e){e.message?r.error(e.message):e.data?e.data.message?r.error(e.data.message):r.error(e.data):r.error("Inespected Error!"),l.reject(e)})};return s?w2confirm(s,function(e){"Yes"===e&&d()}):d(),l.promise},a.getDataURLImagemObjeto=function(e,t,n,i){var o=0,r=0;e instanceof HTMLImageElement?(o=e.naturalWidth,r=e.naturalHeight):(o=e.videoWidth,r=e.videoHeight);var a=document.createElement("canvas"),c=t,s=n,l=1;r>o?(l=c/o,s=l*r):(l=s/r,c=l*o),a.width=c,a.height=s;var d=a.getContext("2d");return d.drawImage(e,0,0,o,r,0,0,c,s),a.toDataURL("image/png",i)},a.listenExpression=function(e,t){if(event.ctrlKey&&event.shiftKey){var n="http://www.wordreference.com/enpt/";window.open(n+e)}else{var i=new SpeechSynthesisUtterance;i.text=e,i.lang="en-US",i.rate=.8,i.onstart=function(e){},i.onend=function(e){t&&t()},speechSynthesis.speak(i)}}}),angular.module("app").controller("AppCtrl",function(e,t,n,i,o,r){e.$route=n,e.$location=o,e.$routeParams=i,t.loading=!1});