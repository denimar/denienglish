angular.module("dictionaryViewMdl",[]),angular.module("TextMdl",[]),angular.module("VideoMdl",[]),angular.module("app",["ngRoute","TextMdl","VideoMdl","ngMaterial","ngResource","ngMessages","ngSanitize","material.svgAssetsCache","ui-deni-grid","uiDeniModalMdl","com.2fdevs.videogular","com.2fdevs.videogular.plugins.controls","info.vietnamcode.nampnq.videogular.plugins.youtube","summernote"]),angular.module("app").config(function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|javascript):/)}),angular.module("app").constant("DictionaryModalEnums",{SearchState:{STOPPED:0,SEARCHING:1,SEARCHED:2,ADDING:3,ADDED:4}}),angular.module("app").service("categoryRestSrv",function(e){var t=this;t.add=function(t,n){var i={title:"Adding",message:"Category added successfully!"};return e.requestWithPromise("category/add",{cd_categoria_pai:t,ds_categoria:n},i)},t.rename=function(t,n){var i={title:"Editing",message:"Category renamed successfully!"};return e.requestWithPromise("category/upd",{cd_categoria:t,ds_categoria:n},i)},t.del=function(t){var n={title:"Deleting",message:"Category deleted successfully!"};return e.requestWithPromise("category/del",{cd_categoria:t},n,"Confirm deleting?")}}),angular.module("app").service("categorySrv",function(e,t,n){var i=this;i.add=function(i,r){var o=e.defer();return n.prompt("New Category","Enter a descrption of the category","",!0,i).then(function(e){t.add(r,e).then(function(e){o.resolve(e.data.data[0])})}),o.promise},i.rename=function(i,r,o){var a=e.defer();return n.prompt("Renaming Category","Enter a descrption of the category",o,!0,i).then(function(e){t.rename(r,e).then(function(e){a.resolve(e.data.data[0].dsCategoria)})}),a.promise},i.del=function(e){return t.del(e)}}),angular.module("app").service("DictionaryRestSrv",function(e){var t=this;t.list=function(){return e.requestWithPromise("dictionary/list")},t.add=function(t,n){var i={title:"Inserting",message:"Expression added successfully!"};return e.requestWithPromise("dictionary/add",{ds_expressao:t,ds_tags:n},i)},t.del=function(t){var n={title:"Deleting",message:"Expression deleted successfully!"};return e.requestWithPromise("dictionary/del",{cd_dicionario:t},n,"Confirm deleting?")},t.learnedToogle=function(t){var n={title:"Updating",message:"Expression updated successfully!"};return e.requestWithPromise("dictionary/learned/toogle",{cd_dicionario:t},n)},t.definitionSet=function(t,n){var i={title:"Updating",message:"Expression updated successfully!"};return e.requestWithPromisePayLoad("dictionary/definition/set",{},{cd_dicionario:t,tx_definicao:n},i)},t.definitionGet=function(t){return e.requestWithPromise("dictionary/definition/get",{cd_dicionario:t})}}),angular.module("app").service("dictionarySrv",function(e,t,n){var i=this;i.list=function(){return t.list()},i.add=function(e,n){return t.add(e,n)},i.del=function(e){return t.del(e)},i.learnedToogle=function(e){return t.learnedToogle(e)},i.definitionSet=function(e,n){return t.definitionSet(e,n)},i.definitionGet=function(n){var i=e.defer();return t.definitionGet(n).then(function(e){i.resolve(e.data.data[0].txDefinicao)}),i.promise},i.showModal=function(e){return n.showModal(e,i.definitionGet)}}),angular.module("app").service("ItemRestSrv",function(e){var t=this;t.list=function(t){return e.requestWithPromise("item/list",{cd_categoria:t})},t.get=function(t){return e.requestWithPromise("item/get",{cd_item:t})},t.add=function(t,n,i,r){var o={title:"Inserting",message:"Item added successfully!"};return e.requestWithPromisePayLoad("item/add",{topCategoryNode:t,cd_categoria:n,ds_item:i},{bt_imagem:r},o)},t.upd=function(t,n,i,r){var o={title:"Updating",message:"Item updated successfully!"};return e.requestWithPromisePayLoad("item/upd",{cd_item:t,cd_categoria:n,ds_item:i},{bt_imagem:r},o)},t.del=function(t){var n={title:"Deleting",message:"Item deleted successfully!"};return e.requestWithPromise("item/del",{cd_item:t},n,"Confirm deleting?")},t.favorite={set:function(t,n){return e.requestWithPromise("item/favorite/set",{cd_item:t,bl_favorite:n})},get:function(t){return e.requestWithPromise("item/favorite/get",{cd_item:t})}}}),angular.module("app").service("itemSrv",function(e,t,n,i,r,o,a,s,c){var d=this,l=function(e){var o=t.defer(),s=r.createWindowDescriptionMoreImage();return s.show().then(function(e){if("ok"==e.button){var t=i.getDataURLImagemObjeto(e.data.imageEl.get(0),150,150,.5);n.add(a.CategoryType.TEXT,i.currentCategory,e.data.description,t).then(function(e){o.resolve(e)})}else o.reject()}),o.promise},u=function(n){var r=t.defer();return n.newVideoItemModal={canShowImagePreview:!1,tp_video:0},n.newVideoItemModal.getImagePreviewUrl=function(){return n.newVideoItemModal.canShowImagePreview=n.newVideoItemModal.id_video&&(0==n.newVideoItemModal.tp_video&&11==n.newVideoItemModal.id_video.length||1==n.newVideoItemModal.tp_video&&28==n.newVideoItemModal.id_video.length),n.newVideoItemModal.canShowImagePreview?c.SERVER_URL+"item/image/getlink?tp_video="+n.newVideoItemModal.tp_video+"&id_video="+n.newVideoItemModal.id_video:null},o.showModal(n).then(function(t){e.loading=!0,s.add(i.currentCategory,n.newVideoItemModal.tp_video,n.newVideoItemModal.id_video,n.newVideoItemModal.description).then(function(t){r.resolve(t),e.loading=!1})}),r.promise};d.add=function(e,t){return t==a.CategoryType.TEXT?l(e):u(e)},d.del=function(e){return n.del(e)},d.favorite={set:function(e,i){var r=t.defer();return n.favorite.set(e,i).then(function(e){r.resolve(e.data.data[0].blFavorite)},function(e){r.reject(e)}),r.promise},get:function(e){var i=t.defer();return n.favorite.get(e).then(function(e){i.resolve(e.data.data[0].blFavorite)},function(e){i.reject(e)}),i.promise}}}),angular.module("app").service("PronunciationRestSrv",function(e){var t=this;t.list=function(){return e.requestWithPromise("pronunciation/list")},t.add=function(t){var n={title:"Inserting",message:"Expression added successfully!"};return e.requestWithPromise("pronunciation/add",{ds_expressao:t},n)},t.del=function(t){var n={title:"Deleting",message:"Expression deleted successfully!"};return e.requestWithPromise("pronunciation/del",{cd_pronuncia:t},n,"Confirm deleting?")},t.learnedToogle=function(t){var n={title:"Updating",message:"Expression updated successfully!"};return e.requestWithPromise("pronunciation/learned/toogle",{cd_pronuncia:t},n)}}),angular.module("app").service("pronunciationSrv",function(e,t){this.listenExpression=function(n){var i=e.defer();try{if(event.ctrlKey&&event.shiftKey){var r="http://www.wordreference.com/enpt/";t.open(r+n)}else var o=setInterval(function(){var e=speechSynthesis.getVoices();if(0!==e.length){clearInterval(o);var t=new SpeechSynthesisUtterance;t.text=n,t.lang="en-US";for(var r=0;r<e.length;r++)if(e[r].lang==t.lang){t.voice=e[r];break}t.rate=.8,t.onstart=function(e){},t.onend=function(e){i.resolve()},speechSynthesis.speak(t)}},200)}catch(a){i.reject(a)}return i.promise}}),angular.module("app").service("RevisionRestSrv",function(e){var t=this;t.getItemInfo=function(t){return e.requestWithPromise("revision/item/info",{cd_item:t})},t.getExpressions=function(t){return e.requestWithPromise("revision/expressions/get",{cd_item:t})},t.setLevelOfLearning=function(t,n,i){return e.requestWithPromise("revision/expressions/levelOfLearning/set",{cd_dicionario:t,cd_pronuncia:n,nr_level_of_learning:i})},t.markAsReviewed=function(t){return e.requestWithPromise("revision/markasreviewed",{cd_item:t})}}),angular.module("app").service("revisionSrv",function(e,t){var n=this;n.getItemInfo=function(n){var i=e.defer();return t.getItemInfo(n).then(function(e){var t=e.data.data[0];i.resolve(t)},function(e){i.reject(e)}),i.promise},n.getExpressions=function(n){var i=e.defer();return t.getExpressions(n).then(function(e){var t=e.data.data;i.resolve(t)},function(e){i.reject(e)}),i.promise},n.setLevelOfLearning=function(n,i,r){var o=e.defer();return t.setLevelOfLearning(n,i,r).then(function(e){var t=e.data.data[0];o.resolve(t)},function(e){o.reject(e)}),o.promise}}),angular.module("app").service("dictionaryModalSrv",function(e,t,n,i){var r=this;r.controller,r.getDefinitionFn;var o;r.setController=function(e){r.controller=e},r.showModal=function(t,n){r.getDefinitionFn=n,e.createWindow({scope:t,title:"Dictionary",width:"700px",height:"580px",position:e.POSITION.CENTER,buttons:[e.BUTTON.OK],urlTemplate:"src/app/shared/dictionary/dictionary-modal/dictionary-modal.tpl.htm",modal:!0,listeners:{onshow:function(e){}}}).show()};var a=function(e){var t=$(document.createElement("div"));t.html(e),$(".dictionary-modal .definition").html(""),$(".dictionary-modal .definition").append(t)};r.getGridDictionaryOptions=function(){return{keyField:"cdDicionario",url:n.SERVER_URL+"dictionary/list",hideHeaders:!0,columns:[{name:"dsExpressao",width:"45%"},{name:"dsTags",width:"45%"},{width:"10%",action:{mdIcon:"delete_forever",tooltip:"Remove a expression from dictionary",fn:function(e,t,n){i.del(e.cdDicionario).then(function(e){r.controller.gridDictionaryOptions.api.reload()})}}}],listeners:{onselectionchange:function(e,t,n,i){r.getDefinitionFn(i.cdDicionario).then(function(e){o=i.cdDicionario,r.controller.currentDefinitionBeforeEditing=e,r.controller.currentDefinition=e,a(e)})},onbeforeload:function(){a("")}}}},r.searchInputChange=function(){r.controller.searchState=t.SearchState.SEARCHING},r.searchInputKeydown=function(){13==event.keyCode&&(r.controller.searchState==t.SearchState.SEARCHING?r.searchButtonClick(r.controller):r.controller.searchState==t.SearchState.SEARCHED&&r.searchButtonAddClick(r.controller))},r.showSearchButton=function(e){return"search"==e&&r.controller.searchState==t.SearchState.SEARCHING||"add"==e&&r.controller.searchState==t.SearchState.SEARCHED},r.searchButtonClick=function(){r.controller.searchState=t.SearchState.SEARCHED;var e=$(".dictionary-modal .search-input");r.controller.gridDictionaryOptions.api.filter(e.val())},r.searchButtonAddClick=function(){r.controller.searchState=t.SearchState.ADDED;var e=$(".dictionary-modal .search-input");i.add(e.val(),"").then(function(e){r.controller.gridDictionaryOptions.api.reload(),r.controller.searchState=t.SearchState.STOPPED})},r.showLoading=function(){return r.controller.searchState==t.SearchState.ADDED},r.definitionEditClick=function(){r.controller.editingDefinition=!0},r.definitionSaveClick=function(){i.definitionSet(o,r.controller.currentDefinition).then(function(e){r.controller.editingDefinition=!1,a(r.controller.currentDefinition)})},r.definitionCancelClick=function(){r.controller.currentDefinition=r.controller.currentDefinitionBeforeEditing,r.controller.editingDefinition=!1}}),angular.module("app").service("DatabaseSrv",function(){}),angular.module("app").service("GeneralSrv",function(e,t,n,i,r,o){var a=this;a.getAllExpressions=function(){var t=e.defer();return i.list().then(function(e){o.dictionaryExpressions=e.data.data,r.list().then(function(e){o.pronunciationExpressions=e.data.data,o.allExpressions=o.dictionaryExpressions.concat(o.pronunciationExpressions),t.resolve(o.allExpressions)},function(e){console.error(e)})},function(e){console.error(e)}),t.promise},a.insertHtmlWithController=function(e,t,i,r){e.html("");var o=$("<div>"+t+"</div>");n(o)(r),e.append(o)}}),angular.module("app").service("StringSrv",function(e){var t=this;t.format=function(){for(var e=arguments[0],t=1;t<arguments.length;t++){var n=new RegExp("\\{"+(t-1).toString()+"\\}","gi");e=e.replace(n,arguments[t])}return e},t.leftPad=function(e,t,n){var i=t-e.toString().length+1;return Array(+(i>0&&i)).join(n)+e},t.replaceAll=function(e,t,n){return e?e.replace(RegExp("\\b"+t+"\\b","g"),n):""},t.doubleToStrTime=function(e){var n=3600,i=60,r=e/n,o=t.leftPad(Math.floor(r),2,"0"),a=e/i,s=t.leftPad(Math.floor(a),2,"0"),c=(e%i).toString(),d="000",l=c.indexOf(".");return l!=-1&&(d=c.substring(l+1).substring(0,3),d+="0".repeat(3-d.length),c=c.substring(0,l)),c=t.leftPad(Math.floor(c),2,"0")+","+d,o+":"+s+":"+c},t.strTimeToDouble=function(e){var t=e,n=parseInt(t.substring(0,2)),i=parseInt(t.substring(3,5));t=t.substring(6,t.length).replace(",",".");var r=parseFloat(t);return 3600*n+60*i+r},t.addLinksDictionaryAndPronunciation=function(n){var i=e.allExpressions;if(0==i.length)return n;for(var r=t.replaceAll(n,'"',"'"),o=r.toLowerCase(),a="matrizsubst1-{0}-matrizsubst2",s=[],c=0,d=0;d<i.length;d++)for(var l=i[d],u=l.dsExpressao.toLowerCase(),p=o.search(new RegExp("\\b"+u+"\\b"));p!=-1;){var m=r.substring(p,p+u.length);if(m.toLowerCase()==u){s.push({cd_pronuncia:l.cdPronuncia,cd_dicionario:l.cdDicionario,ds_expressao:l.dsExpressao,texto:m});var f=t.format(a,c);r=r.replace(new RegExp("\\b"+m+"\\b","g"),f),c++,o=r.toLowerCase()}p=o.search(new RegExp("\\b"+u+"\\b"))}for(var d=0;d<s.length;d++){var l=s[d],g=t.format(a,d),h=null,v=null,S=null;l.cd_dicionario?(v="openDictionary",S="dictionary-link"):(v="openPronunciation",S="pronunciation-link"),h=t.format('<span class="'+S+'" ng-click="'+v+"('"+l.ds_expressao+"');\">"+l.ds_expressao+"</span>",t.replaceAll(l.ds_expressao,"'","\\'"),t.replaceAll(l.texto,"'","\\'")),r=t.replaceAll(r,g,h)}return r}}),angular.module("app").service("newVideoItemModalSrv",function(e,t){var n=this;n.showModal=function(n){var i=e.defer(),r=t.createWindow({scope:n,title:"Creating a new video",width:"550px",height:"300px",position:t.POSITION.CENTER,buttons:[t.BUTTON.OK,t.BUTTON.CANCEL],urlTemplate:"src/app/shared/item/new-video-item-modal/new-video-item-modal.tpl.htm",modal:!0,listeners:{onshow:function(e){n.newVideoItemModal.kindOfVideo=0}}});return r.show().then(function(e){"ok"==e.button?i.resolve(n.newVideoItemModal):i.reject()}),i.promise}}),angular.module("app").service("spacedRevisionSrv",function(e,t,n,i,r,o,a,s){var c=this;c.controller,c.setController=function(e){c.controller=e},c.selectExpression=function(e){c.controller.expressions.length>0&&(c.controller.currentExpressionIndex=e,c.controller.currentExpression=c.controller.expressions[e],c.controller.model.expression.dsExpressao=c.controller.currentExpression.dsExpressao,c.controller.model.expression.type=0!=c.controller.currentExpression.cdDicionario?"Dictionary":"Pronuciation",c.controller.model.expression.resultType=0!=c.controller.currentExpression.cdDicionario?"menu":"volume_up",c.controller.model.expression.learnedRate=c.controller.currentExpression.nrLevelOfLearning,c.controller.model.expression.definition="")},c.showResult=function(e){0!=e.currentExpression.cdDicionario?(event.ctrlKey&&r.listenExpression(e.model.expression.dsExpressao),i.definitionGet(e.currentExpression.cdDicionario).then(function(t){e.model.expression.definition=t;var n=$(document.createElement("div"));n.html(t),$(".definition-detail-content-content").html(""),$(".definition-detail-content-content").append(n)})):angular.isDefined(e.currentExpression.cdPronuncia)&&r.listenExpression(e.model.expression.dsExpressao)},c.updateLearnedPercentage=function(){for(var e=c.controller.element.find(".item-detail-data-progress-bar"),t=e.width(),n=0,i=0;i<c.controller.expressions.length;i++)n+=c.controller.expressions[i].nrLevelOfLearning;var r=n/c.controller.expressions.length;c.controller.model.learnedPercentage=r.toFixed(2);var o=c.controller.element.find(".item-detail-data-progress");o.width(t*r/100)},c.markAsReviewed=function(e){return o.markAsReviewed(e).then(function(){a.ghost("Spaced Revision","Item marked as reviewed successfuly!")})},c.showModal=function(i,r){e.selectedCdItem=r,s.getExpressions(r).then(function(i){a.createWindow({scope:e,title:"Spaced Revision",width:"900px",height:"600px",position:a.POSITION.CENTER,buttons:[a.BUTTON.OK],urlTemplate:"src/app/shared/spaced-revision/spaced-revision-modal/spaced-revision-modal.tpl.htm",modal:!0,listeners:{onshow:function(e){s.getItemInfo(r).then(function(o){c.controller.expressions=i,c.selectExpression(0),c.controller.element=$(e),c.updateLearnedPercentage(c.controller.expressions),c.controller.cdItem=r,c.controller.itemImage=t.format("{0}item/image/get?cd_item={1}&time={2}",n.SERVER_URL,r,(new Date).getMilliseconds()),c.controller.dsItem=o.dsItem,c.controller.dsBreadCrumbPath=o.dsBreadCrumbPath})}}}).show()})}}),angular.module("dictionaryViewMdl").controller("dictionaryViewSrv",function(){}),angular.module("app").controller("DictionaryModalCtrl",function(e,t){e.setController(this),this.searchState=t.SearchState.STOPPED,this.editingDefinition=!1,this.searchValue="",this.gridDictionaryOptions=e.getGridDictionaryOptions(),this.searchInputChange=e.searchInputChange,this.searchInputKeydown=e.searchInputKeydown,this.searchButtonClick=e.searchButtonClick,this.searchButtonAddClick=e.searchButtonClick,this.showSearchButton=e.showSearchButton,this.showLoading=e.showLoading,this.definitionEditClick=e.definitionEditClick,this.definitionSaveClick=e.definitionSaveClick,this.definitionCancelClick=e.definitionCancelClick}),angular.module("app").controller("NewVideoItemModalCtrl",function(e){var t=this,n=function(e,t,n,i){var r=0,o=0;e instanceof HTMLImageElement?(r=e.naturalWidth,o=e.naturalHeight):(r=e.videoWidth,o=e.videoHeight);var a=document.createElement("canvas"),s=t,c=n,d=1;o>r?(d=s/r,c=d*o):(d=c/o,s=d*r),a.width=s,a.height=c;var l=a.getContext("2d");return l.drawImage(e,0,0,r,o,0,0,s,c),a.toDataURL("image/jpeg",i)};t.capturePosterFromVideo=function(){var e=$(".video-preview").get(0),t=n(e,150,150,.5);console.log(t)}}),angular.module("app").controller("SpacedRevisionCtrl",function(e,t,n,i,r,o,a){var s=this;a.setController(s),s.learnedRate=60,s.expressions=[],s.currentExpression,s.currentExpressionIndex,s.model={expression:{}},s.model.navigatorStatus="",s.navigate=function(e){a.selectExpression(s.currentExpressionIndex+e)},s.navigateFirst=function(){a.selectExpression(0)},s.navigateLast=function(){a.selectExpression(s.expressions.length-1)},s.showResult=function(){a.showResult(s)},s.changeLearnedRate=function(){r.setLevelOfLearning(s.currentExpression.cdDicionario,s.currentExpression.cdPronuncia,s.model.expression.learnedRate),s.currentExpression.nrLevelOfLearning=s.model.expression.learnedRate,a.updateLearnedPercentage(s)},s.markAsReviewed=function(e){a.markAsReviewed(e),console.log("TODO: FAZER UMA ROTINA NA uiDeniModal para fechar a janela ativa..."),console.log("TODO: VERIFICAR TAMBÉM O UI-DENI-MODAL... PASSAGEM DO Scope...")}}),angular.module("dictionaryViewMdl").controller("DictionaryViewCtrl",function(){alert("here 2")}),angular.module("dictionaryViewMdl").directive("dictionaryView",function(){return{restrict:"E",bindToController:{expressao:"="},controller:"DictionaryViewCtrl",controllerAs:"ctrl",templateUrl:"srv/app/shared/dictionary-view/dictionary-view.tpl.htm"}}),angular.module("app").service("homeSrv",function(e,t,n,i,r,o,a,s,c,d){var l=this,u=null;l.addCategoryClick=function(e,n){t.add(e,n).then(function(e){var t={state:"open",id:e.cdCategoria,text:e.dsCategoria,data:e};u.create_node(n,t,"last",function(e){u.deselect_all(),u.select_node(e)})})},l.editCategoryClick=function(e,n){t.rename(e,n.id,n.text).then(function(e){u.rename_node(n,e)})},l.delCategoryClick=function(e){t.del(e.id).then(function(t){var n=u.get_node(e.parent);u.delete_node([e]),u.select_node(n)})};var p=function(e){return"#"==e.currentCategoryNode.parent?e.currentCategoryNode.id:e.currentCategoryNode.parents[e.currentCategoryNode.parents.length-2]};l.addNewItemButtonClick=function(e,t,n){var i=p(e);r.add(t,i).then(function(t){e.gridOptions.api.reload().then(function(n){var i=t.data[0],r=i.cdItem||i.t05itm.cdItem;e.gridOptions.api.findKey(r,{inLine:!0})})})};var m=function(e,t){e.currentCategoryNode=t.node,i.currentCategory=e.currentCategoryNode.id;for(var n='<span class="categoryPathTitle">'+e.currentCategoryNode.text+"</span>",r=e.currentCategoryNode.parent;"#"!=r;){var o=t.instance.get_node(r);n=o.text+" / "+n;var r=o.parent}e.categoryPath=n};l.reloadDataGrid=function(e){e.currentCategoryNode&&("pageItems"==e.currentNavItem?e.gridOptions.url=n.SERVER_URL+"item/list?cd_categoria="+e.currentCategoryNode.id:"pageRevisions"==e.currentNavItem?e.gridOptions.url=n.SERVER_URL+"revision/list?pendente=true&days=5&cd_categoria="+e.currentCategoryNode.id:e.gridOptions.url=n.SERVER_URL+"item/favorite/get?cd_categoria="+e.currentCategoryNode.id,e.gridOptions.api.reload())},l.configureTreeView=function(e,t){$("#categoryTreeview").on("loaded.jstree",function(e,n){u=n.instance,t&&u.select_node(t)}).on("changed.jstree",function(t,n){n.node&&(m(e,n),l.reloadDataGrid(e))}).jstree({core:{check_callback:!0,data:{url:n.SERVER_URL+"category/category/tree/list",dataType:"json"}},plugins:["wholerow"]})},l.configureGridItems=function(t,l){t.gridOptions={hideHeaders:!0,colLines:!1,keyField:"cdItem",rowHeight:"100px",columns:[{header:"Item",name:"cdItem",width:"calc(100% - 96px)",renderer:function(e,i){var r=null,s=p(t);r=s==o.CategoryType.TEXT?"/text":"/video";var c=new Date,d=c.getMilliseconds(),l=i.blFavorite?"star":"star_border",u=i.blFavorite?"selected":"",m='<div class="cell-template">\n    <img class="item-image"\n        src="{0}item/image/get?cd_item={1}&time={5}" \n    />\n    <div><a href="#{2}/{1}">{3}</a></div>\n    <div>{4}</div>\n    <md-icon class="material-icons favorite {6}" ng-click="funcaoTeste()"> {7} </md-icon>\n<div>';return a.format(m,n.SERVER_URL,i.cdItem,r,i.dsItem,"blá blá blá blá",d,u,l)}},{width:"32px",action:{mdIcon:"restore",tooltip:"",fn:function(e,t,n){s.showModal(l,e.cdItem)}}},{width:"32px",action:{mdIcon:"edit",tooltip:"",fn:function(e,n,r){var o=$(r).closest(".ui-row"),a=o.find(".item-image"),s={description:e.dsItem,imgSrc:a.attr("src")},l=c.createWindowDescriptionMoreImage(s);l.show().then(function(n){if("ok"==n.button){var r=i.getDataURLImagemObjeto(n.data.imageEl.get(0),160,140,1);d.upd(e.cdItem,i.currentCategory,n.data.description,r).then(function(e){t.gridOptions.api.reload().then(function(i){a.attr("src",n.data.image);var r=e.data[0].cdItem;t.gridOptions.api.findKey(r,{inLine:!0})})})}})}}},{width:"32px",action:{mdIcon:"delete_forever",tooltip:"",fn:function(e,n,i){r.del(e.cdItem).then(function(){t.gridOptions.api.reload()})}}}],listeners:{onafterload:function(e,t){},onafterrepaintrow:function(n,i){e(function(){i.find(".material-icons.favorite").click(function(e){var n=t.gridOptions.api.getSelectedRow();r.favorite.set(n.cdItem,!n.blFavorite).then(function(e){n.blFavorite=e,t.gridOptions.api.repaintSelectedRow()})})},500)}}}}}),angular.module("app").service("TextRestSrv",function(e){var t=this;t.list=function(t){return e.requestWithPromise("text/list",{cd_item:t})},t.getContent=function(t){return e.requestWithPromise("text/content/get",{cd_texto:t})},t.setContent=function(t,n){var i={title:"Texts",message:"text updated successfully!"};return e.requestWithPromisePayLoad("text/content/set",{},{cd_texto:t,tx_conteudo:n},i)}}),angular.module("TextMdl").service("TextSrv",function(e,t,n,i){var r=this;r.configWYSIWYG=function(n,i){var o=function(){t.setContent(n.t07txt.cdTexto,n.content).then(function(e){r.setContent(n,i,e.data[0].txConteudo),n.editing=!1})},a=function(){n.content=n.contentStored,n.editing=!1,i.$apply()};n.options=e.getConfigWYSIWYG(o,a)},r.setContent=function(e,t,r){var o=$(".text .text-content");e.content=r,e.formatedContent=n.addLinksDictionaryAndPronunciation(e.content),i.insertHtmlWithController(o,e.formatedContent,"TextCtrl",t)}}),angular.module("app").service("VideoRestSrv",function(e){var t=this;t.add=function(t,n,i,r){var o={title:"Videos",message:"Video added successfully!"};return e.requestWithPromisePayLoad("video/add",{},{cd_categoria:t,tp_video:n,id_video:i,ds_item:r},o)},t.get=function(t){return e.requestWithPromise("video/get",{cd_item:t})},t.commentaries={set:function(t,n){var i={title:"Videos",message:"commentary updated successfully!"};return e.requestWithPromisePayLoad("video/commentary/set",{cd_video:t},{txCommentaries:n},i)}}}),angular.module("VideoMdl").service("VideoSrv",function(e,t,n,i,r,o,a,s,c){var d=this,l=function(e,t){for(var n=e.gridSubtitlesOptions.data,i=0;i<n.length;i++){var r=n[i];if(t>=r.nrStart&&t<=r.nrEnd){i!=e.gridSubtitlesOptions.api.getSelectedRowIndex()&&e.gridSubtitlesOptions.api.selectRow(i,!0,!1);break}}},u=!1;d.configElementVideo=function(e,n){var a=r.defer();return e.onPlayerReady=function(t){e.videoAPI=t,e.videoAPI.autoPlay=!1;var n=i(function(){angular.isDefined(e.currentTime)&&i.cancel(n)},1e3)},e.onUpdateTime=function(t,n){e.currentTime=1e3*t,e.totalTime=1e3*n,e.timeLeft=e.totalTime-e.currentTime,u||l(e,t)},o.get(n).then(function(n){var i=n.data.data[0];a.resolve(i);"YOUTUBE"==i.tpVideo?urlImage="https://www.youtube.com/watch?v="+i.idVideo:urlImage="https://googledrive.com/host/"+i.idVideo,e.videoConfig={autoPlay:!1,sources:[{src:t.trustAsResourceUrl(urlImage),type:"video/mp4"}],theme:{url:"dist/videogular/videogular.css"},plugins:{controls:{autoHide:!0,autoHideTime:5e3}}}}),a.promise},d.configGridSubtitles=function(t,i){t.gridSubtitlesOptions={keyField:"cdItemSubtitle",rowHeight:"37px",url:a.SERVER_URL+"/subtitle/list?cd_item="+i,hideHeaders:!0,columns:[{name:"nrStart",width:"15%",align:"center",renderer:function(e,t){return s.doubleToStrTime(e)}},{name:"nrEnd",width:"15%",align:"center",renderer:function(e,t){return s.doubleToStrTime(e)}},{name:"dsTexto",width:"80%",renderer:function(e,i){var r=$("<div>"+s.addLinksDictionaryAndPronunciation(e)+"</div>");return n(r)(t.scope),r}}],listeners:{onselectionchange:function(n,i,r,o){u=!0;try{t.videoAPI.seekTime(o.nrStart)}finally{e(function(){u=!1},1500)}}}}},d.configWYSIWYG=function(e,t){var n=function(){o.commentaries.set(e.t08vdo.cdVideo,e.t08vdo.txComentarios)},i=function(){o.get(t).then(function(t){e.t08vdo=t.data.data[0]})};e.options=c.getConfigWYSIWYG(n,i)}}),angular.module("app").service("SubtitleRestSrv",function(e){var t=this;t.list=function(t){return e.requestWithPromise("subtitle/list",{cd_item:t})},t.add=function(t,n,i,r){var o={title:"Inserting",message:"Subtitle added successfully!"};return e.requestWithPromisePayLoad("subtitle/add",{},{cd_video:t,nr_start:n,nr_end:i,ds_texto:r},o)},t.upd=function(t,n,i,r){var o={title:"Updating",message:"Subtitle updated successfully!"};return e.requestWithPromisePayLoad("subtitle/upd",{},{cd_item_subtitle:t,nr_start:n,nr_end:i,ds_texto:r},o)},t.del=function(t){var n={title:"Deleting",message:"Subtitle deleted successfully!"};return e.requestWithPromise("subtitle/del",{cd_item_subtitle:t},n,"Confirm deleting?")}}),angular.module("VideoMdl").service("subtitleModalSrv",function(e,t,n,i){var r=this,o={ADDING:1,EDITING:2},a=function(r,a,s){var c=e.defer();a.subtitleModalData={};var d=a.gridSubtitlesOptions.api.getSelectedRow();if(s==o.EDITING){var d=a.gridSubtitlesOptions.api.getSelectedRow();a.subtitleModalData.start=n.doubleToStrTime(d.nrStart),a.subtitleModalData.end=n.doubleToStrTime(d.nrEnd),a.subtitleModalData.text=d.dsTexto}else d&&(a.subtitleModalData.start=n.doubleToStrTime(d.nrStart+1),a.subtitleModalData.end=n.doubleToStrTime(d.nrStart+2));var l=t.createWindow({scope:r,title:"Subtitles",width:"450px",height:"230px",position:t.POSITION.CENTER,buttons:[t.BUTTON.OK,t.BUTTON.CANCEL],urlTemplate:"src/app/components/video/subtitle/modals/subtitle-modal.tpl.htm",modal:!0,listeners:{onshow:function(e){}}});return l.show().then(function(e){if("ok"==e.button){a.subtitleModalData.start=n.strTimeToDouble(a.subtitleModalData.start),a.subtitleModalData.end=n.strTimeToDouble(a.subtitleModalData.end),console.log(a.subtitleModalData),s==o.EDITING?i.upd(d.cdItemSubtitle,a.subtitleModalData.start,a.subtitleModalData.end,a.subtitleModalData.text).then(function(e){c.resolve(e.data[0])}):i.add(a.t08vdo.cdVideo,a.subtitleModalData.start,a.subtitleModalData.end,a.subtitleModalData.text).then(function(e){c.resolve(e.data[0])})}else c.reject("")}),c.promise};r.add=function(e,t){return a(e,t,o.ADDING)},r.edit=function(e,t){return a(e,t,o.EDITING)}}),angular.module("app").controller("HomeCtrl",function(e,t,n,i,r){var o=this;o.categoryPath=null,r.createHamburgerButton(["show-xs","hide-gt-xs"],i.Side.LEFT),o.currentNavItem="pageItems",o.currentCategoryNode=null,$.jstree.defaults.core.themes.variant="large",o.addCategoryClick=function(){n.addCategoryClick(e,o.currentCategoryNode.id)},o.editCategoryClick=function(){n.editCategoryClick(e,o.currentCategoryNode)},o.delCategoryClick=function(){n.delCategoryClick(o.currentCategoryNode)},o.addNewItemButtonClick=function(t){n.addNewItemButtonClick(o,e,t)},n.configureTreeView(o,r.currentCategory||t.cdCategoria),n.configureGridItems(o,e),e.$watch("ctrl.currentNavItem",function(e,t){o.currentNavItem=e,e&&n.reloadDataGrid(o)})}),angular.module("TextMdl").controller("TextCtrl",function(e,t,n,i,r,o,a,s,c){var d=this;d.editing=!1,d.params=n,d.texts=[],d.selectedIndex=-1,d.contentStored="",d.content="",d.formatedContent="",d.t07txt=null,o.configWYSIWYG(d,e),r.list(d.params.cdItem).then(function(e){d.texts=e.data.data,d.selectedIndex=0}),e.$watch("ctrl.selectedIndex",function(n,i){n!=i&&d.texts.length>0&&(t.loading=!0,d.t07txt=d.texts[n],r.getContent(d.t07txt.cdTexto).then(function(n){a.getAllExpressions().then(function(i){o.setContent(d,e,n.data.data[0].txConteudo),t.loading=!1})}))}),d.editClick=function(){d.contentStored=d.content,d.editing=!0},e.openDictionary=function(t){alert("here"),c.createWindow({scope:e,title:"Dictionary - "+t,width:"600px",height:"300px",position:c.POSITION.CENTER,buttons:[c.BUTTON.OK],htmlTemplate:'<dictionary-view expression="house" style="width:100%;height:100%;display:block;"></dictionary-view>',modal:!0}).show()},e.openPronunciation=function(e){alert("Pronunciation - "+e)}}),angular.module("VideoMdl").controller("VideoCtrl",function(e,t,n,i,r,o,a,s,c,d){var l=this;l.scope=e,e.name="VideoCtrl",e.params=t,l.cdItem=e.params.cdItem,l.commentaries="",l.initialCommentaries="",r.configElementVideo(l,e.params.cdItem).then(function(e){l.t08vdo=e}),r.configGridSubtitles(l,e.params.cdItem),r.configWYSIWYG(l,e.params.cdItem),i.getAllExpressions().then(function(e){l.gridSubtitlesOptions.api.repaint()}),l.dictionaryModalClick=function(){d.showModal(e)},l.addSubtitleButtonClick=function(){o.add(e,l).then(function(e){l.gridSubtitlesOptions.api.reload().then(function(){l.gridSubtitlesOptions.api.findKey(e.cdItemSubtitle,{inLine:!0})})})},l.editSubtitleButtonClick=function(){o.edit(e,l).then(function(e){l.gridSubtitlesOptions.api.reload().then(function(){l.gridSubtitlesOptions.api.findKey(e.cdItemSubtitle,{inLine:!0})})})},l.delSubtitleButtonClick=function(){var e=l.gridSubtitlesOptions.api.getSelectedRow();a.del(e.cdItemSubtitle).then(function(){l.gridSubtitlesOptions.api.reload()})};var u=function(e){var t=l.gridSubtitlesOptions.api.getSelectedRow(),n=t.cdItemSubtitle;t.nrStart=t.nrStart+e,t.nrEnd=t.nrEnd+e,a.upd(n,t.nrStart,t.nrEnd,t.dsTexto).then(function(e){s.ghost("Subtitle","Subtitle time is update successfully"),l.gridSubtitlesOptions.api.repaint(),l.gridSubtitlesOptions.api.findKey(n,{inLine:!0})})};l.decreaseOneSecondButtonClick=function(){u(-1)},l.incrementOneSecondButtonClick=function(){u(1)},l.listenButtonClick=function(){var e=l.gridSubtitlesOptions.api.getSelectedRow();c.listenExpression(e.dsTexto)}}),angular.module("app").constant("AppConsts",{SERVER_URL:"https://denienglishsrv-denimar.rhcloud.com/"}),angular.module("app").constant("AppEnums",{CategoryType:{TEXT:275,VIDEO:276},Side:{LEFT:1,RIGHT:2}}),angular.module("app").config(function(e){e.when("/:cdCategoria?",{templateUrl:"src/app/components/home/home.htm",controller:"HomeCtrl",controllerAs:"ctrl"}).when("/text/:cdItem",{templateUrl:"src/app/components/text/text.htm",controller:"TextCtrl",controllerAs:"ctrl"}).when("/video/:cdItem",{templateUrl:"src/app/components/video/video.htm",controller:"VideoCtrl",controllerAs:"ctrl"}).otherwise({redirectTo:"/"})}),angular.module("app").service("AppSrv",function(e,t,n,i,r,o){var a=this;a.currentCategory=null,a.allExpressions=[],a.dictionaryExpressions=[],a.pronunciationExpressions=[],a.auxiliarMenu=[],a.createHamburgerButton=function(e,t){var n=$(document.createElement("button"));n.addClass("md-button"),n.addClass("md-icon-button"),n.addClass("md-ink-ripple");
for(var r=0;r<e.length;r++){var o=e[r];n.attr(o,""),n.addClass(o)}var a=$(document.createElement("img"));a.attr("src","src/assets/images/hamburger.png"),a.addClass("hamburger-button"),n.append(a);var s=$("#md-toolbar-tools-main");t==i.Side.LEFT?s.prepend(n):s.append(n)},a.getNgRepeatTrackById=function(e){var t=Object.keys(e)[0];return e[t]},a.getConfigWYSIWYG=function(e,t){var n=function(t){var n=$.summernote.ui,i=n.button({contents:'<i class="glyphicon glyphicon-floppy-save"/>',tooltip:"save changes",click:function(){e()}});return i.render()},i=function(e){var n=$.summernote.ui,i=n.button({contents:'<i class="glyphicon glyphicon-remove"/>',tooltip:"cancel changes",click:function(){t()}});return i.render()};return{toolbar:[["saveOrCancelButtons",["saveButton","cancelButton"]],["fontsize",["fontname","fontsize","color"]],["style",["bold","italic","underline","clear"]],["para",["ul","ol","paragraph"]],["height",["height"]],["table",["table"]],["insert",["link","picture","video","hr"]],["view",["fullscreen","codeview"]]],buttons:{saveButton:n,cancelButton:i}}},a.requestWithPromise=function(t,i,a,s){var c=e.defer(),d={params:i},l=function(){n.get(r.SERVER_URL+t,d).then(function(e){if(!e.data.success)throw e.data.message;a&&o.ghost(a.title,a.message),c.resolve(e)})["catch"](function(e){e.data.message?o.error(e.data.message):o.error(e.data),c.reject(e)})};return s?o.confirm(s).then(function(e){"yes"===e.button&&l()}):l(),c.promise},a.requestWithPromisePayLoad=function(n,i,a,s,c){var d=e.defer(),l=function(){var e=t(r.SERVER_URL+n,i,{},{request:{method:"POST"}});e.save(a).$promise.then(function(e){e.success?(s&&o.ghost(s.title,s.message),d.resolve(e)):(o.error(e.message),d.reject(e))})["catch"](function(e){e.message?o.error(e.message):e.data?e.data.message?o.error(e.data.message):o.error(e.data):o.error("Inespected Error!"),d.reject(e)})};return c?w2confirm(c,function(e){"Yes"===e&&l()}):l(),d.promise},a.getDataURLImagemObjeto=function(e,t,n,i){var r=0,o=0;e instanceof HTMLImageElement?(r=e.naturalWidth,o=e.naturalHeight):(r=e.videoWidth,o=e.videoHeight);var a=document.createElement("canvas"),s=t,c=n,d=1;o>r?(d=s/r,c=d*o):(d=c/o,s=d*r),a.width=s,a.height=c;var l=a.getContext("2d");return l.drawImage(e,0,0,r,o,0,0,s,c),a.toDataURL("image/png",i)},a.listenExpression=function(e,t){if(event.ctrlKey&&event.shiftKey){var n="http://www.wordreference.com/enpt/";window.open(n+e)}else{var i=new SpeechSynthesisUtterance;i.text=e,i.lang="en-US",i.rate=.8,i.onstart=function(e){},i.onend=function(e){t&&t()},speechSynthesis.speak(i)}}}),angular.module("app").controller("AppCtrl",function(e,t,n,i,r,o){e.$route=n,e.$location=r,e.$routeParams=i,t.loading=!1});